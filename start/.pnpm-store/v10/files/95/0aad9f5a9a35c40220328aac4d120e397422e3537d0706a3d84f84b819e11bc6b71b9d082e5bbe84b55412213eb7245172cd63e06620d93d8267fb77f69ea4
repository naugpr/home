#!/usr/bin/env node
import it from 'chalk';
import { Command, Option } from 'commander';
import H from 'node:fs/promises';
import k from 'node:path';
import Bt from 'ora';
import gr from 'yaml';
import Re from 'node:os';
import Lr from 'node:dns/promises';
import { execa } from 'execa';
import Vt from 'prompts';
import { Buffer as Buffer$1 } from 'node:buffer';
import Xe, { randomUUID, createHash } from 'node:crypto';
import { PostHog } from 'posthog-node';
import { Listr } from 'listr2';
import { createRequire } from 'node:module';
import { promisify } from 'node:util';
import oe from 'node:fs';
import { fileURLToPath } from 'node:url';
import z from 'semver';

var ki=Object.create;var kr=Object.defineProperty;var Ai=Object.getOwnPropertyDescriptor;var Pi=Object.getOwnPropertyNames;var Bi=Object.getPrototypeOf,Ti=Object.prototype.hasOwnProperty;var Ar=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var P=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Ri=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Pi(e))!Ti.call(r,o)&&o!==t&&kr(r,o,{get:()=>e[o],enumerable:!(n=Ai(e,o))||n.enumerable});return r};var Pr=(r,e,t)=>(t=r!=null?ki(Bi(r)):{},Ri(kr(t,"default",{value:r,enumerable:true}),r));var Et=P((sd,_n)=>{var Zt=[],Mn=0,L=(r,e)=>{Mn>=e&&Zt.push(r);};L.WARN=1;L.INFO=2;L.DEBUG=3;L.reset=()=>{Zt=[];};L.setDebugLevel=r=>{Mn=r;};L.warn=r=>L(r,L.WARN);L.info=r=>L(r,L.INFO);L.debug=r=>L(r,L.DEBUG);L.debugMessages=()=>Zt;_n.exports=L;});var In=P((ad,Hn)=>{Hn.exports=({onlyFirst:r=false}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")};});var On=P((ud,jn)=>{var zs=In();jn.exports=r=>typeof r=="string"?r.replace(zs(),""):r;});var Nn=P((cd,er)=>{var Ln=r=>Number.isNaN(r)?false:r>=4352&&(r<=4447||r===9001||r===9002||11904<=r&&r<=12871&&r!==12351||12880<=r&&r<=19903||19968<=r&&r<=42182||43360<=r&&r<=43388||44032<=r&&r<=55203||63744<=r&&r<=64255||65040<=r&&r<=65049||65072<=r&&r<=65131||65281<=r&&r<=65376||65504<=r&&r<=65510||110592<=r&&r<=110593||127488<=r&&r<=127569||131072<=r&&r<=262141);er.exports=Ln;er.exports.default=Ln;});var Vn=P((ld,Un)=>{Un.exports=function(){return /\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F|\uD83D\uDC68(?:\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68\uD83C\uDFFB|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFE])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D[\uDC68\uDC69])\u200D(?:\uD83D[\uDC66\uDC67])|[\u2695\u2696\u2708]\uFE0F|\uD83D[\uDC66\uDC67]|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|(?:\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708])\uFE0F|\uD83C\uDFFB\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C[\uDFFB-\uDFFF])|(?:\uD83E\uDDD1\uD83C\uDFFB\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)\uD83C\uDFFB|\uD83E\uDDD1(?:\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1)|(?:\uD83E\uDDD1\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFF\u200D\uD83E\uDD1D\u200D(?:\uD83D[\uDC68\uDC69]))(?:\uD83C[\uDFFB-\uDFFE])|(?:\uD83E\uDDD1\uD83C\uDFFC\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB\uDFFC])|\uD83D\uDC69(?:\uD83C\uDFFE\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB-\uDFFD\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFC\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFD-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFB\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFC-\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFD\u200D(?:\uD83E\uDD1D\u200D\uD83D\uDC68(?:\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C\uDFFF\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD]))|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67]))|(?:\uD83E\uDDD1\uD83C\uDFFD\u200D\uD83E\uDD1D\u200D\uD83E\uDDD1|\uD83D\uDC69\uD83C\uDFFE\u200D\uD83E\uDD1D\u200D\uD83D\uDC69)(?:\uD83C[\uDFFB-\uDFFD])|\uD83D\uDC69\u200D\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC69\u200D(?:\uD83D[\uDC66\uDC67])|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C\uDFFF\u200D[\u2695\u2696\u2708]|\uD83C\uDFFE\u200D[\u2695\u2696\u2708]|\uD83C\uDFFC\u200D[\u2695\u2696\u2708]|\uD83C\uDFFB\u200D[\u2695\u2696\u2708]|\uD83C\uDFFD\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)\uFE0F|\uD83D\uDC6F|\uD83E[\uDD3C\uDDDE\uDDDF])\u200D[\u2640\u2642]|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\uD83C\uDFF4\u200D\u2620)\uFE0F|\uD83D\uDC69\u200D\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|\uD83D\uDC15\u200D\uD83E\uDDBA|\uD83D\uDC69\u200D\uD83D\uDC66|\uD83D\uDC69\u200D\uD83D\uDC67|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDF6\uD83C\uDDE6|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83E\uDDD1(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDB5\uDDB6\uDDBB\uDDD2-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDED5\uDEEB\uDEEC\uDEF4-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFA\uDFE0-\uDFEB]|\uD83E[\uDD0D-\uDD3A\uDD3C-\uDD45\uDD47-\uDD71\uDD73-\uDD76\uDD7A-\uDDA2\uDDA5-\uDDAA\uDDAE-\uDDCA\uDDCD-\uDDFF\uDE70-\uDE73\uDE78-\uDE7A\uDE80-\uDE82\uDE90-\uDE95])\uFE0F|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDC8F\uDC91\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD0F\uDD18-\uDD1F\uDD26\uDD30-\uDD39\uDD3C-\uDD3E\uDDB5\uDDB6\uDDB8\uDDB9\uDDBB\uDDCD-\uDDCF\uDDD1-\uDDDD])/g};});var Gn=P((dd,tr)=>{var qs=On(),Xs=Nn(),Ys=Vn(),Wn=r=>{if(typeof r!="string"||r.length===0||(r=qs(r),r.length===0))return 0;r=r.replace(Ys(),"  ");let e=0;for(let t=0;t<r.length;t++){let n=r.codePointAt(t);n<=31||n>=127&&n<=159||n>=768&&n<=879||(n>65535&&t++,e+=Xs(n)?2:1);}return e};tr.exports=Wn;tr.exports.default=Wn;});var rr=P((fd,Yn)=>{var zn=Gn();function Ft(r){return r?/\u001b\[((?:\d*;){0,5}\d*)m/g:/\u001b\[(?:\d*;){0,5}\d*m/g}function Z(r){let e=Ft();return (""+r).replace(e,"").split(`
`).reduce(function(o,i){return zn(i)>o?zn(i):o},0)}function Ke(r,e){return Array(e+1).join(r)}function Ks(r,e,t,n){let o=Z(r);if(e+1>=o){let i=e-o;switch(n){case "right":{r=Ke(t,i)+r;break}case "center":{let s=Math.ceil(i/2),a=i-s;r=Ke(t,a)+r+Ke(t,s);break}default:{r=r+Ke(t,i);break}}}return r}var _e={};function Je(r,e,t){e="\x1B["+e+"m",t="\x1B["+t+"m",_e[e]={set:r,to:true},_e[t]={set:r,to:false},_e[r]={on:e,off:t};}Je("bold",1,22);Je("italics",3,23);Je("underline",4,24);Je("inverse",7,27);Je("strikethrough",9,29);function qn(r,e){let t=e[1]?parseInt(e[1].split(";")[0]):0;if(t>=30&&t<=39||t>=90&&t<=97){r.lastForegroundAdded=e[0];return}if(t>=40&&t<=49||t>=100&&t<=107){r.lastBackgroundAdded=e[0];return}if(t===0){for(let o in r)Object.prototype.hasOwnProperty.call(r,o)&&delete r[o];return}let n=_e[e[0]];n&&(r[n.set]=n.to);}function Js(r){let e=Ft(true),t=e.exec(r),n={};for(;t!==null;)qn(n,t),t=e.exec(r);return n}function Xn(r,e){let t=r.lastBackgroundAdded,n=r.lastForegroundAdded;return delete r.lastBackgroundAdded,delete r.lastForegroundAdded,Object.keys(r).forEach(function(o){r[o]&&(e+=_e[o].off);}),t&&t!="\x1B[49m"&&(e+="\x1B[49m"),n&&n!="\x1B[39m"&&(e+="\x1B[39m"),e}function Qs(r,e){let t=r.lastBackgroundAdded,n=r.lastForegroundAdded;return delete r.lastBackgroundAdded,delete r.lastForegroundAdded,Object.keys(r).forEach(function(o){r[o]&&(e=_e[o].on+e);}),t&&t!="\x1B[49m"&&(e=t+e),n&&n!="\x1B[39m"&&(e=n+e),e}function Zs(r,e){if(r.length===Z(r))return r.substr(0,e);for(;Z(r)>e;)r=r.slice(0,-1);return r}function ea(r,e){let t=Ft(true),n=r.split(Ft()),o=0,i=0,s="",a,u={};for(;i<e;){a=t.exec(r);let c=n[o];if(o++,i+Z(c)>e&&(c=Zs(c,e-i)),s+=c,i+=Z(c),i<e){if(!a)break;s+=a[0],qn(u,a);}}return Xn(u,s)}function ta(r,e,t){if(t=t||"\u2026",Z(r)<=e)return r;e-=Z(t);let o=ea(r,e);o+=t;let i="\x1B]8;;\x07";return r.includes(i)&&!o.includes(i)&&(o+=i),o}function ra(){return {chars:{top:"\u2500","top-mid":"\u252C","top-left":"\u250C","top-right":"\u2510",bottom:"\u2500","bottom-mid":"\u2534","bottom-left":"\u2514","bottom-right":"\u2518",left:"\u2502","left-mid":"\u251C",mid:"\u2500","mid-mid":"\u253C",right:"\u2502","right-mid":"\u2524",middle:"\u2502"},truncate:"\u2026",colWidths:[],rowHeights:[],colAligns:[],rowAligns:[],style:{"padding-left":1,"padding-right":1,head:["red"],border:["grey"],compact:false},head:[]}}function na(r,e){r=r||{},e=e||ra();let t=Object.assign({},e,r);return t.chars=Object.assign({},e.chars,r.chars),t.style=Object.assign({},e.style,r.style),t}function oa(r,e){let t=[],n=e.split(/(\s+)/g),o=[],i=0,s;for(let a=0;a<n.length;a+=2){let u=n[a],c=i+Z(u);i>0&&s&&(c+=s.length),c>r?(i!==0&&t.push(o.join("")),o=[u],i=Z(u)):(o.push(s||"",u),i=c),s=n[a+1];}return i&&t.push(o.join("")),t}function ia(r,e){let t=[],n="";function o(s,a){for(n.length&&a&&(n+=a),n+=s;n.length>r;)t.push(n.slice(0,r)),n=n.slice(r);}let i=e.split(/(\s+)/g);for(let s=0;s<i.length;s+=2)o(i[s],s&&i[s-1]);return n.length&&t.push(n),t}function sa(r,e,t=true){let n=[];e=e.split(`
`);let o=t?oa:ia;for(let i=0;i<e.length;i++)n.push.apply(n,o(r,e[i]));return n}function aa(r){let e={},t=[];for(let n=0;n<r.length;n++){let o=Qs(e,r[n]);e=Js(o);let i=Object.assign({},e);t.push(Xn(i,o));}return t}function ua(r,e){let t="\x1B]",n="\x07",o=";";return [t,"8",o,o,r||e,n,e,t,"8",o,o,n].join("")}Yn.exports={strlen:Z,repeat:Ke,pad:Ks,truncate:ta,mergeOptions:na,wordWrap:sa,colorizeLines:aa,hyperlink:ua};});var Zn=P((md,Qn)=>{var Jn={};Qn.exports=Jn;var Kn={reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29],black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],gray:[90,39],grey:[90,39],brightRed:[91,39],brightGreen:[92,39],brightYellow:[93,39],brightBlue:[94,39],brightMagenta:[95,39],brightCyan:[96,39],brightWhite:[97,39],bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgGray:[100,49],bgGrey:[100,49],bgBrightRed:[101,49],bgBrightGreen:[102,49],bgBrightYellow:[103,49],bgBrightBlue:[104,49],bgBrightMagenta:[105,49],bgBrightCyan:[106,49],bgBrightWhite:[107,49],blackBG:[40,49],redBG:[41,49],greenBG:[42,49],yellowBG:[43,49],blueBG:[44,49],magentaBG:[45,49],cyanBG:[46,49],whiteBG:[47,49]};Object.keys(Kn).forEach(function(r){var e=Kn[r],t=Jn[r]=[];t.open="\x1B["+e[0]+"m",t.close="\x1B["+e[1]+"m";});});var to=P((pd,eo)=>{eo.exports=function(r,e){e=e||process.argv;var t=e.indexOf("--"),n=/^-{1,2}/.test(r)?"":"--",o=e.indexOf(n+r);return o!==-1&&(t===-1?true:o<t)};});var no=P((gd,ro)=>{var ca=Ar("os"),K=to(),U=process.env,He=void 0;K("no-color")||K("no-colors")||K("color=false")?He=false:(K("color")||K("colors")||K("color=true")||K("color=always"))&&(He=true);"FORCE_COLOR"in U&&(He=U.FORCE_COLOR.length===0||parseInt(U.FORCE_COLOR,10)!==0);function la(r){return r===0?false:{level:r,hasBasic:true,has256:r>=2,has16m:r>=3}}function da(r){if(He===false)return 0;if(K("color=16m")||K("color=full")||K("color=truecolor"))return 3;if(K("color=256"))return 2;if(r&&!r.isTTY&&He!==true)return 0;var e=He?1:0;if(process.platform==="win32"){var t=ca.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in U)return ["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(function(o){return o in U})||U.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in U)return /^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(U.TEAMCITY_VERSION)?1:0;if("TERM_PROGRAM"in U){var n=parseInt((U.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(U.TERM_PROGRAM){case "iTerm.app":return n>=3?3:2;case "Hyper":return 3;case "Apple_Terminal":return 2}}return /-256(color)?$/i.test(U.TERM)?2:/^screen|^xterm|^vt100|^rxvt|color|ansi|cygwin|linux/i.test(U.TERM)||"COLORTERM"in U?1:(U.TERM==="dumb",e)}function nr(r){var e=da(r);return la(e)}ro.exports={supportsColor:nr,stdout:nr(process.stdout),stderr:nr(process.stderr)};});var io=P((hd,oo)=>{oo.exports=function(e,t){var n="";e=e||"Run the trap, drop the bass",e=e.split("");var o={a:["@","\u0104","\u023A","\u0245","\u0394","\u039B","\u0414"],b:["\xDF","\u0181","\u0243","\u026E","\u03B2","\u0E3F"],c:["\xA9","\u023B","\u03FE"],d:["\xD0","\u018A","\u0500","\u0501","\u0502","\u0503"],e:["\xCB","\u0115","\u018E","\u0258","\u03A3","\u03BE","\u04BC","\u0A6C"],f:["\u04FA"],g:["\u0262"],h:["\u0126","\u0195","\u04A2","\u04BA","\u04C7","\u050A"],i:["\u0F0F"],j:["\u0134"],k:["\u0138","\u04A0","\u04C3","\u051E"],l:["\u0139"],m:["\u028D","\u04CD","\u04CE","\u0520","\u0521","\u0D69"],n:["\xD1","\u014B","\u019D","\u0376","\u03A0","\u048A"],o:["\xD8","\xF5","\xF8","\u01FE","\u0298","\u047A","\u05DD","\u06DD","\u0E4F"],p:["\u01F7","\u048E"],q:["\u09CD"],r:["\xAE","\u01A6","\u0210","\u024C","\u0280","\u042F"],s:["\xA7","\u03DE","\u03DF","\u03E8"],t:["\u0141","\u0166","\u0373"],u:["\u01B1","\u054D"],v:["\u05D8"],w:["\u0428","\u0460","\u047C","\u0D70"],x:["\u04B2","\u04FE","\u04FC","\u04FD"],y:["\xA5","\u04B0","\u04CB"],z:["\u01B5","\u0240"]};return e.forEach(function(i){i=i.toLowerCase();var s=o[i]||[" "],a=Math.floor(Math.random()*s.length);typeof o[i]<"u"?n+=o[i][a]:n+=i;}),n};});var ao=P((Dd,so)=>{so.exports=function(e,t){e=e||"   he is here   ";var n={up:["\u030D","\u030E","\u0304","\u0305","\u033F","\u0311","\u0306","\u0310","\u0352","\u0357","\u0351","\u0307","\u0308","\u030A","\u0342","\u0313","\u0308","\u034A","\u034B","\u034C","\u0303","\u0302","\u030C","\u0350","\u0300","\u0301","\u030B","\u030F","\u0312","\u0313","\u0314","\u033D","\u0309","\u0363","\u0364","\u0365","\u0366","\u0367","\u0368","\u0369","\u036A","\u036B","\u036C","\u036D","\u036E","\u036F","\u033E","\u035B","\u0346","\u031A"],down:["\u0316","\u0317","\u0318","\u0319","\u031C","\u031D","\u031E","\u031F","\u0320","\u0324","\u0325","\u0326","\u0329","\u032A","\u032B","\u032C","\u032D","\u032E","\u032F","\u0330","\u0331","\u0332","\u0333","\u0339","\u033A","\u033B","\u033C","\u0345","\u0347","\u0348","\u0349","\u034D","\u034E","\u0353","\u0354","\u0355","\u0356","\u0359","\u035A","\u0323"],mid:["\u0315","\u031B","\u0300","\u0301","\u0358","\u0321","\u0322","\u0327","\u0328","\u0334","\u0335","\u0336","\u035C","\u035D","\u035E","\u035F","\u0360","\u0362","\u0338","\u0337","\u0361"," \u0489"]},o=[].concat(n.up,n.down,n.mid);function i(u){var c=Math.floor(Math.random()*u);return c}function s(u){var c=false;return o.filter(function(l){c=l===u;}),c}function a(u,c){var l="",d,p;c=c||{},c.up=typeof c.up<"u"?c.up:true,c.mid=typeof c.mid<"u"?c.mid:true,c.down=typeof c.down<"u"?c.down:true,c.size=typeof c.size<"u"?c.size:"maxi",u=u.split("");for(p in u)if(!s(p)){switch(l=l+u[p],d={up:0,down:0,mid:0},c.size){case "mini":d.up=i(8),d.mid=i(2),d.down=i(8);break;case "maxi":d.up=i(16)+3,d.mid=i(4)+1,d.down=i(64)+3;break;default:d.up=i(8)+1,d.mid=i(6)/2,d.down=i(8)+1;break}var m=["up","mid","down"];for(var f in m)for(var g=m[f],D=0;D<=d[g];D++)c[g]&&(l=l+n[g][i(n[g].length)]);}return l}return a(e,t)};});var co=P((yd,uo)=>{uo.exports=function(r){return function(e,t,n){if(e===" ")return e;switch(t%3){case 0:return r.red(e);case 1:return r.white(e);case 2:return r.blue(e)}}};});var fo=P((wd,lo)=>{lo.exports=function(r){return function(e,t,n){return t%2===0?e:r.inverse(e)}};});var po=P((bd,mo)=>{mo.exports=function(r){var e=["red","yellow","green","blue","magenta"];return function(t,n,o){return t===" "?t:r[e[n++%e.length]](t)}};});var ho=P((Cd,go)=>{go.exports=function(r){var e=["underline","inverse","grey","yellow","red","green","blue","white","cyan","magenta","brightYellow","brightRed","brightGreen","brightBlue","brightWhite","brightCyan","brightMagenta"];return function(t,n,o){return t===" "?t:r[e[Math.round(Math.random()*(e.length-2))]](t)}};});var vo=P((xd,Co)=>{var E={};Co.exports=E;E.themes={};var fa=Ar("util"),ve=E.styles=Zn(),yo=Object.defineProperties,ma=new RegExp(/[\r\n]+/g);E.supportsColor=no().supportsColor;typeof E.enabled>"u"&&(E.enabled=E.supportsColor()!==false);E.enable=function(){E.enabled=true;};E.disable=function(){E.enabled=false;};E.stripColors=E.strip=function(r){return (""+r).replace(/\x1B\[\d+m/g,"")};E.stylize=function(e,t){if(!E.enabled)return e+"";var n=ve[t];return !n&&t in E?E[t](e):n.open+e+n.close};var pa=/[|\\{}()[\]^$+*?.]/g,ga=function(r){if(typeof r!="string")throw new TypeError("Expected a string");return r.replace(pa,"\\$&")};function wo(r){var e=function t(){return Da.apply(t,arguments)};return e._styles=r,e.__proto__=ha,e}var bo=function(){var r={};return ve.grey=ve.gray,Object.keys(ve).forEach(function(e){ve[e].closeRe=new RegExp(ga(ve[e].close),"g"),r[e]={get:function(){return wo(this._styles.concat(e))}};}),r}(),ha=yo(function(){},bo);function Da(){var r=Array.prototype.slice.call(arguments),e=r.map(function(s){return s!=null&&s.constructor===String?s:fa.inspect(s)}).join(" ");if(!E.enabled||!e)return e;for(var t=e.indexOf(`
`)!=-1,n=this._styles,o=n.length;o--;){var i=ve[n[o]];e=i.open+e.replace(i.closeRe,i.open)+i.close,t&&(e=e.replace(ma,function(s){return i.close+s+i.open}));}return e}E.setTheme=function(r){if(typeof r=="string"){console.log("colors.setTheme now only accepts an object, not a string.  If you are trying to set a theme from a file, it is now your (the caller's) responsibility to require the file.  The old syntax looked like colors.setTheme(__dirname + '/../themes/generic-logging.js'); The new syntax looks like colors.setTheme(require(__dirname + '/../themes/generic-logging.js'));");return}for(var e in r)(function(t){E[t]=function(n){if(typeof r[t]=="object"){var o=n;for(var i in r[t])o=E[r[t][i]](o);return o}return E[r[t]](n)};})(e);};function ya(){var r={};return Object.keys(bo).forEach(function(e){r[e]={get:function(){return wo([e])}};}),r}var wa=function(e,t){var n=t.split("");return n=n.map(e),n.join("")};E.trap=io();E.zalgo=ao();E.maps={};E.maps.america=co()(E);E.maps.zebra=fo()(E);E.maps.rainbow=po()(E);E.maps.random=ho()(E);for(Do in E.maps)(function(r){E[r]=function(e){return wa(E.maps[r],e)};})(Do);var Do;yo(E,ya());});var Eo=P((Ed,xo)=>{var ba=vo();xo.exports=ba;});var Ao=P((Fd,St)=>{var{info:Ca,debug:ko}=Et(),W=rr(),ir=class r{constructor(e){this.setOptions(e),this.x=null,this.y=null;}setOptions(e){["boolean","number","bigint","string"].indexOf(typeof e)!==-1&&(e={content:""+e}),e=e||{},this.options=e;let t=e.content;if(["boolean","number","bigint","string"].indexOf(typeof t)!==-1)this.content=String(t);else if(!t)this.content=this.options.href||"";else throw new Error("Content needs to be a primitive, got: "+typeof t);this.colSpan=e.colSpan||1,this.rowSpan=e.rowSpan||1,this.options.href&&Object.defineProperty(this,"href",{get(){return this.options.href}});}mergeTableOptions(e,t){this.cells=t;let n=this.options.chars||{},o=e.chars,i=this.chars={};xa.forEach(function(u){or(n,o,u,i);}),this.truncate=this.options.truncate||e.truncate;let s=this.options.style=this.options.style||{},a=e.style;or(s,a,"padding-left",this),or(s,a,"padding-right",this),this.head=s.head||a.head,this.border=s.border||a.border,this.fixedWidth=e.colWidths[this.x],this.lines=this.computeLines(e),this.desiredWidth=W.strlen(this.content)+this.paddingLeft+this.paddingRight,this.desiredHeight=this.lines.length;}computeLines(e){let t=e.wordWrap||e.textWrap,{wordWrap:n=t}=this.options;if(this.fixedWidth&&n){if(this.fixedWidth-=this.paddingLeft+this.paddingRight,this.colSpan){let s=1;for(;s<this.colSpan;)this.fixedWidth+=e.colWidths[this.x+s],s++;}let{wrapOnWordBoundary:o=true}=e,{wrapOnWordBoundary:i=o}=this.options;return this.wrapLines(W.wordWrap(this.fixedWidth,this.content,i))}return this.wrapLines(this.content.split(`
`))}wrapLines(e){let t=W.colorizeLines(e);return this.href?t.map(n=>W.hyperlink(this.href,n)):t}init(e){let t=this.x,n=this.y;this.widths=e.colWidths.slice(t,t+this.colSpan),this.heights=e.rowHeights.slice(n,n+this.rowSpan),this.width=this.widths.reduce(So,-1),this.height=this.heights.reduce(So,-1),this.hAlign=this.options.hAlign||e.colAligns[t],this.vAlign=this.options.vAlign||e.rowAligns[n],this.drawRight=t+this.colSpan==e.colWidths.length;}draw(e,t){if(e=="top")return this.drawTop(this.drawRight);if(e=="bottom")return this.drawBottom(this.drawRight);let n=W.truncate(this.content,10,this.truncate);e||Ca(`${this.y}-${this.x}: ${this.rowSpan-e}x${this.colSpan} Cell ${n}`);let o=Math.max(this.height-this.lines.length,0),i;switch(this.vAlign){case "center":i=Math.ceil(o/2);break;case "bottom":i=o;break;default:i=0;}if(e<i||e>=i+this.lines.length)return this.drawEmpty(this.drawRight,t);let s=this.lines.length>this.height&&e+1>=this.height;return this.drawLine(e-i,this.drawRight,s,t)}drawTop(e){let t=[];return this.cells?this.widths.forEach(function(n,o){t.push(this._topLeftChar(o)),t.push(W.repeat(this.chars[this.y==0?"top":"mid"],n));},this):(t.push(this._topLeftChar(0)),t.push(W.repeat(this.chars[this.y==0?"top":"mid"],this.width))),e&&t.push(this.chars[this.y==0?"topRight":"rightMid"]),this.wrapWithStyleColors("border",t.join(""))}_topLeftChar(e){let t=this.x+e,n;if(this.y==0)n=t==0?"topLeft":e==0?"topMid":"top";else if(t==0)n="leftMid";else if(n=e==0?"midMid":"bottomMid",this.cells&&(this.cells[this.y-1][t]instanceof r.ColSpanCell&&(n=e==0?"topMid":"mid"),e==0)){let i=1;for(;this.cells[this.y][t-i]instanceof r.ColSpanCell;)i++;this.cells[this.y][t-i]instanceof r.RowSpanCell&&(n="leftMid");}return this.chars[n]}wrapWithStyleColors(e,t){if(this[e]&&this[e].length)try{let n=Eo();for(let o=this[e].length-1;o>=0;o--)n=n[this[e][o]];return n(t)}catch{return t}else return t}drawLine(e,t,n,o){let i=this.chars[this.x==0?"left":"middle"];if(this.x&&o&&this.cells){let p=this.cells[this.y+o][this.x-1];for(;p instanceof Qe;)p=this.cells[p.y][p.x-1];p instanceof Ze||(i=this.chars.rightMid);}let s=W.repeat(" ",this.paddingLeft),a=t?this.chars.right:"",u=W.repeat(" ",this.paddingRight),c=this.lines[e],l=this.width-(this.paddingLeft+this.paddingRight);n&&(c+=this.truncate||"\u2026");let d=W.truncate(c,l,this.truncate);return d=W.pad(d,l," ",this.hAlign),d=s+d+u,this.stylizeLine(i,d,a)}stylizeLine(e,t,n){return e=this.wrapWithStyleColors("border",e),n=this.wrapWithStyleColors("border",n),this.y===0&&(t=this.wrapWithStyleColors("head",t)),e+t+n}drawBottom(e){let t=this.chars[this.x==0?"bottomLeft":"bottomMid"],n=W.repeat(this.chars.bottom,this.width),o=e?this.chars.bottomRight:"";return this.wrapWithStyleColors("border",t+n+o)}drawEmpty(e,t){let n=this.chars[this.x==0?"left":"middle"];if(this.x&&t&&this.cells){let s=this.cells[this.y+t][this.x-1];for(;s instanceof Qe;)s=this.cells[s.y][s.x-1];s instanceof Ze||(n=this.chars.rightMid);}let o=e?this.chars.right:"",i=W.repeat(" ",this.width);return this.stylizeLine(n,i,o)}},Qe=class{constructor(){}draw(e){return typeof e=="number"&&ko(`${this.y}-${this.x}: 1x1 ColSpanCell`),""}init(){}mergeTableOptions(){}},Ze=class{constructor(e){this.originalCell=e;}init(e){let t=this.y,n=this.originalCell.y;this.cellOffset=t-n,this.offset=va(e.rowHeights,n,this.cellOffset);}draw(e){return e=="top"?this.originalCell.draw(this.offset,this.cellOffset):e=="bottom"?this.originalCell.draw("bottom"):(ko(`${this.y}-${this.x}: 1x${this.colSpan} RowSpanCell for ${this.originalCell.content}`),this.originalCell.draw(this.offset+1+e))}mergeTableOptions(){}};function Fo(...r){return r.filter(e=>e!=null).shift()}function or(r,e,t,n){let o=t.split("-");o.length>1?(o[1]=o[1].charAt(0).toUpperCase()+o[1].substr(1),o=o.join(""),n[o]=Fo(r[o],r[t],e[o],e[t])):n[t]=Fo(r[t],e[t]);}function va(r,e,t){let n=r[e];for(let o=1;o<t;o++)n+=1+r[e+o];return n}function So(r,e){return r+e+1}var xa=["top","top-mid","top-left","top-right","bottom","bottom-mid","bottom-left","bottom-right","left","left-mid","mid","mid-mid","right","right-mid","middle"];St.exports=ir;St.exports.ColSpanCell=Qe;St.exports.RowSpanCell=Ze;});var To=P((Sd,Bo)=>{var{warn:Ea,debug:Fa}=Et(),sr=Ao(),{ColSpanCell:Sa,RowSpanCell:ka}=sr;(function(){function r(m,f){return m[f]>0?r(m,f+1):f}function e(m){let f={};m.forEach(function(g,D){let h=0;g.forEach(function(b){b.y=D,b.x=D?r(f,h):h;let F=b.rowSpan||1,S=b.colSpan||1;if(F>1)for(let T=0;T<S;T++)f[b.x+T]=F;h=b.x+S;}),Object.keys(f).forEach(b=>{f[b]--,f[b]<1&&delete f[b];});});}function t(m){let f=0;return m.forEach(function(g){g.forEach(function(D){f=Math.max(f,D.x+(D.colSpan||1));});}),f}function n(m){return m.length}function o(m,f){let g=m.y,D=m.y-1+(m.rowSpan||1),h=f.y,b=f.y-1+(f.rowSpan||1),F=!(g>b||h>D),S=m.x,T=m.x-1+(m.colSpan||1),B=f.x,Q=f.x-1+(f.colSpan||1),A=!(S>Q||B>T);return F&&A}function i(m,f,g){let D=Math.min(m.length-1,g),h={x:f,y:g};for(let b=0;b<=D;b++){let F=m[b];for(let S=0;S<F.length;S++)if(o(h,F[S]))return  true}return  false}function s(m,f,g,D){for(let h=g;h<D;h++)if(i(m,h,f))return  false;return  true}function a(m){m.forEach(function(f,g){f.forEach(function(D){for(let h=1;h<D.rowSpan;h++){let b=new ka(D);b.x=D.x,b.y=D.y+h,b.colSpan=D.colSpan,c(b,m[g+h]);}});});}function u(m){for(let f=m.length-1;f>=0;f--){let g=m[f];for(let D=0;D<g.length;D++){let h=g[D];for(let b=1;b<h.colSpan;b++){let F=new Sa;F.x=h.x+b,F.y=h.y,g.splice(D+1,0,F);}}}}function c(m,f){let g=0;for(;g<f.length&&f[g].x<m.x;)g++;f.splice(g,0,m);}function l(m){let f=n(m),g=t(m);Fa(`Max rows: ${f}; Max cols: ${g}`);for(let D=0;D<f;D++)for(let h=0;h<g;h++)if(!i(m,h,D)){let b={x:h,y:D,colSpan:1,rowSpan:1};for(h++;h<g&&!i(m,h,D);)b.colSpan++,h++;let F=D+1;for(;F<f&&s(m,F,b.x,b.x+b.colSpan);)b.rowSpan++,F++;let S=new sr(b);S.x=b.x,S.y=b.y,Ea(`Missing cell at ${S.y}-${S.x}.`),c(S,m[D]);}}function d(m){return m.map(function(f){if(!Array.isArray(f)){let g=Object.keys(f)[0];f=f[g],Array.isArray(f)?(f=f.slice(),f.unshift(g)):f=[g,f];}return f.map(function(g){return new sr(g)})})}function p(m){let f=d(m);return e(f),l(f),a(f),u(f),f}Bo.exports={makeTableLayout:p,layoutTable:e,addRowSpanCells:a,maxWidth:t,fillInTable:l,computeWidths:Po("colSpan","desiredWidth","x",1),computeHeights:Po("rowSpan","desiredHeight","y",1)};})();function Po(r,e,t,n){return function(o,i){let s=[],a=[],u={};i.forEach(function(c){c.forEach(function(l){(l[r]||1)>1?a.push(l):s[l[t]]=Math.max(s[l[t]]||0,l[e]||0,n);});}),o.forEach(function(c,l){typeof c=="number"&&(s[l]=c);});for(let c=a.length-1;c>=0;c--){let l=a[c],d=l[r],p=l[t],m=s[p],f=typeof o[p]=="number"?0:1;if(typeof m=="number")for(let g=1;g<d;g++)m+=1+s[p+g],typeof o[p+g]!="number"&&f++;else m=e==="desiredWidth"?l.desiredWidth-1:1,(!u[p]||u[p]<m)&&(u[p]=m);if(l[e]>m){let g=0;for(;f>0&&l[e]>m;){if(typeof o[p+g]!="number"){let D=Math.round((l[e]-m)/f);m+=D,s[p+g]+=D,f--;}g++;}}}Object.assign(o,s,u);for(let c=0;c<o.length;c++)o[c]=Math.max(n,o[c]||0);}}});var $o=P((kd,Ro)=>{var ie=Et(),Aa=rr(),ar=To(),kt=class extends Array{constructor(e){super();let t=Aa.mergeOptions(e);if(Object.defineProperty(this,"options",{value:t,enumerable:t.debug}),t.debug){switch(typeof t.debug){case "boolean":ie.setDebugLevel(ie.WARN);break;case "number":ie.setDebugLevel(t.debug);break;case "string":ie.setDebugLevel(parseInt(t.debug,10));break;default:ie.setDebugLevel(ie.WARN),ie.warn(`Debug option is expected to be boolean, number, or string. Received a ${typeof t.debug}`);}Object.defineProperty(this,"messages",{get(){return ie.debugMessages()}});}}toString(){let e=this,t=this.options.head&&this.options.head.length;t?(e=[this.options.head],this.length&&e.push.apply(e,this)):this.options.style.head=[];let n=ar.makeTableLayout(e);n.forEach(function(i){i.forEach(function(s){s.mergeTableOptions(this.options,n);},this);},this),ar.computeWidths(this.options.colWidths,n),ar.computeHeights(this.options.rowHeights,n),n.forEach(function(i){i.forEach(function(s){s.init(this.options);},this);},this);let o=[];for(let i=0;i<n.length;i++){let s=n[i],a=this.options.rowHeights[i];(i===0||!this.options.style.compact||i==1&&t)&&ur(s,"top",o);for(let u=0;u<a;u++)ur(s,u,o);i+1==n.length&&ur(s,"bottom",o);}return o.join(`
`)}get width(){return this.toString().split(`
`)[0].length}};kt.reset=()=>ie.reset();function ur(r,e,t){let n=[];r.forEach(function(i){n.push(i.draw(e));});let o=n.join("");o.length&&t.push(o);}Ro.exports=kt;});var cr=P((Ad,Mo)=>{Mo.exports=$o();});var ee=class extends Error{constructor(e,t="HBX_ERROR",n){super(e),this.name="HbxError",this.code=t,this.details=n;}},y=class extends ee{constructor(e,t){super(e,"HBX_INPUT_ERROR",t);}},Se=class extends ee{constructor(e="Operation cancelled by user"){super(e,"HBX_ABORTED");}},st=class extends ee{constructor(e,t){super(e,"HBX_CONFIG_ERROR",t);}};function at(r){return !!(r&&typeof r=="object"&&"code"in r)}async function C(r){try{return await H.access(r),!0}catch{return  false}}async function M(r){await H.mkdir(r,{recursive:true});}async function ct(r){if(!await C(r)){await M(r);return}if((await H.readdir(r)).length>0)throw new Error(`Directory ${r} is not empty`)}async function _(r,e){await M(k.dirname(r)),await H.writeFile(r,e);}var dt="hbx",ge="HBX_DEBUG",ke="HBX_LICENSE_TOKEN",Tr="HBX_TELEMETRY_DISABLED",Rr="HBX_POSTHOG_KEY",$r="HBX_POSTHOG_HOST",jt=k.join(Re.homedir(),".hbx"),ft=k.join(jt,"config.json"),Mi=k.join(Re.homedir(),".cache","hbx"),Ae=k.join(Mi,"templates"),Mr="HBX_UPDATE_CHECK_DISABLED",ce="https://api.github.com",_r="https://github.com/HugoBlox/hugo-blox-builder.git",Hr="HBX_TEMPLATES_DIR",he="https://cli-api.hugoblox.com",Ir=`${he}/api/usage-insights`,mt="hugoblox",jr=1e3*60*60*24,Or=1e3*60*60*12;var Ot=[{id:"academic-cv",name:"Academic CV",description:"Publish your academic CV and showcase your research.",repoPath:"templates/academic-cv",slug:"academic-cv",tags:["academic","cv"],source:"oss"},{id:"startup",name:"Startup",description:"Marketing site for SaaS and startups.",repoPath:"templates/startup",slug:"startup",tags:["business"],source:"oss"},{id:"folio",name:"Portfolio",description:"Minimal portfolio for creatives.",repoPath:"templates/folio",slug:"folio",tags:["portfolio"],source:"oss"}];var pt="hbx.blocks.json",De=["github.com/HugoBlox/kit/modules","github.com/HugoBlox/hugo-blox-builder","github.com/wowchemy/wowchemy-hugo-themes"],Ge=[{from:"github.com/HugoBlox/hugo-blox-builder/modules/blox-tailwind",to:"github.com/HugoBlox/kit/modules/blox"},{from:"github.com/HugoBlox/hugo-blox-builder/modules/blox-analytics",to:"github.com/HugoBlox/kit/modules/analytics"},{from:"github.com/HugoBlox/hugo-blox-builder/modules/blox-plugin-netlify",to:"github.com/HugoBlox/kit/modules/integrations/netlify"},{from:"github.com/HugoBlox/hugo-blox-builder/modules/blox-plugin-reveal",to:"github.com/HugoBlox/kit/modules/slides"}],te="github.com/HugoBlox/hugo-blox-builder/",gt="github.com/HugoBlox/kit/";var ye=class extends Error{constructor(t,n){super(t);this.cause=n;this.name="NetworkError";}};async function le(r,e={}){let{timeout:t=15e3,retries:n=3,backoff:o=500,...i}=e,s=0;for(;s<=n;){let a=new AbortController,u=setTimeout(()=>a.abort(),t);try{let c=await fetch(r,{...i,signal:a.signal});if(clearTimeout(u),c.status===429||c.status>=500&&c.status<600)throw new ye(`Server error: ${c.status}`);return c}catch(c){clearTimeout(u),s++;let l=c.name==="AbortError";if(s>n)throw l?new ye(`Request timed out after ${t}ms`,c):c instanceof ye?c:new ye("Network request failed",c);let p=o*2**(s-1);await new Promise(m=>setTimeout(m,p));}}throw new ye("Unreachable")}async function Nr(){try{return await Lr.lookup("google.com"),!0}catch{try{return await Lr.lookup("1.1.1.1"),!0}catch{return  false}}}var Lt=new Map,ze=new Map;function Ur(){Lt.clear(),ze.clear();}async function Nt(r){let e=Lt.get(r);if(e)return e;if(ze.has(r))return await ze.get(r)??[];let t=Pe(),n=le(`${ce}/repos/${r}/tags?per_page=100`,{headers:t}).then(async o=>{if(!o.ok){let s=o.status===403?`GitHub API rate limit exceeded (${o.status}). Set GITHUB_TOKEN env var for higher limits.`:`GitHub API error: ${o.status} for repo ${r}`;throw new Error(s)}let i=await o.json();return Lt.set(r,i),i});ze.set(r,n);try{return await n}catch(o){throw ze.delete(r),o}}async function Ut(r){try{let e=Pe(),t=await le(r,{headers:e});if(t.ok)return (await t.json()).commit.committer.date}catch{}}async function ht(r,e,t){let n=Pe();n.Accept="application/vnd.github.v3.raw";let o=t?`?ref=${t}`:"",i=`${ce}/repos/${r}/contents/${e}${o}`;try{let s=await le(i,{headers:n});return s.ok?await s.text():void 0}catch{return}}async function Dt(r,e){let t=Pe(),n=`${ce}/repos/${r}/contents/${e}`,o=await le(n,{headers:t});if(!o.ok)throw o.status===404?new Error("Directory not found"):new Error(`GitHub API error: ${o.status}`);return await o.json()}async function yt(r,e){let t=encodeURIComponent(e),n=`${ce}/repos/${r}/commits?path=${t}&per_page=1`;try{let o=Pe(),i=await le(n,{headers:o});if(!i.ok)return;let s=await i.json();return s[0]?{sha:s[0].sha,date:s[0].commit?.committer?.date}:void 0}catch{return}}async function Vr(r,e="main"){let t=Pe(),n=await le(`${ce}/repos/${r}/commits/${e}`,{headers:t});if(!n.ok)throw new Error(`Failed to fetch branch ${e}: ${n.status}`);let i=(await n.json()).commit?.tree?.sha;if(!i)throw new Error("Could not find tree SHA in commit data");let s=await le(`${ce}/repos/${r}/git/trees/${i}?recursive=1`,{headers:t});if(!s.ok)throw new Error(`Failed to fetch tree: ${s.status}`);return (await s.json()).tree}function Pe(){let r={"User-Agent":"hbx-cli",Accept:"application/vnd.github.v3+json"};return process.env.GITHUB_TOKEN&&(r.Authorization=`token ${process.env.GITHUB_TOKEN}`),r}async function j(r=process.cwd()){let e=process.cwd(),t=false;typeof r=="string"?e=r:(e=r.startDir??process.cwd(),t=!!r.strict);let n=e,{root:o}=k.parse(e);for(;;){if((await Promise.all([C(k.join(n,"config","_default")),C(k.join(n,"hugoblox.yaml"))])).some(Boolean))return {root:n,manifestPath:k.join(n,pt)};if(n===o){if(t)throw new y("No HugoBlox project found. Please run this command from within a HugoBlox site.");return}n=k.dirname(n);}}async function Wr(r){let e=k.join(r,"hugoblox.yaml");if(await C(e))try{let t=await H.readFile(e,"utf8"),n=gr.parse(t);if(!n)return;let o=n.template??{},i=n.build??{};return {templateId:o.id,templateName:o.name,requiredHugoVersion:i.hugo_version}}catch(t){throw new y("Failed to parse hugoblox.yaml",{error:t})}}async function Te(r={}){try{let{stdout:e}=await execa("hugo",["version"]),t=ji(e);if(!t&&r.strict)throw new Error(`Failed to parse Hugo version from output: ${e}`);return t}catch(e){if(r.strict)throw new y(`Hugo CLI not found or failed to run. Please install Hugo (extended edition) v0.120+.
DEBUG: ${String(e)}`);return}}function ji(r){let e=r.match(/v(\d+\.\d+\.\d+)/i);return e?e[1]:r.match(/(\d+\.\d+\.\d+)/)?.[1]}async function Gr(){try{let r=await fetch("https://api.github.com/repos/gohugoio/hugo/releases/latest",{signal:AbortSignal.timeout(3e3)});return r.ok?(await r.json()).tag_name.replace(/^v/,""):void 0}catch{return}}async function q(r,e={}){if(e.ci){if(typeof e.initial=="string")return e.initial;throw new y(`Option required in CI mode: ${r}`)}return (await Vt({type:"text",name:"value",message:r,initial:e.initial},{onCancel:()=>{throw new Se}})).value}async function qe(r,e,t={}){if(t.ci){if(typeof t.initial=="string")return t.initial;throw new y(`Option required in CI mode: ${r}`)}return (await Vt({type:"select",name:"value",message:r,choices:e,initial:0},{onCancel:()=>{throw new Se}})).value}async function O(r,e={}){if(e.ci){if(typeof e.initial=="boolean")return e.initial;throw new y(`Confirmation required in CI mode: ${r}`)}return (await Vt({type:"confirm",name:"value",message:r,initial:e.initial??true},{onCancel:()=>{throw new Se}})).value}var zr="",qr="https://app.posthog.com";var Ui=new Set(["command","project","duration","status","errorCode","errorMessage","metadata"]),Vi=new Set(["template","templateId","cli_name","cli_version","os_arch","hugoVersion","user_id","user_type","language","locale"]),Wi=50,Gi=6144,Xr=25e3,we=class{#e;#t;#r;#a=[];#n;#g=false;#u;#c;#l;#o;#i;#d;#f;#m;#p;#s;constructor(e,t,n,o="hbx"){this.#e=e,this.#t=t,this.#r=n,this.#d=o,this.#c=process.env.HBX_RELEASE_CHANNEL??process.env.RELEASE_CHANNEL??"stable",this.#f=`${Re.platform()}-${process.arch}`,this.#s=Xi(),this.#p=Yi(this.#s),this.#l=randomUUID(),this.#i=this.#e.getTelemetryId(),this.#o=this.#w(),this.#b();}isEnabled(){return this.#e.isTelemetryEnabled()}setCommand(e){this.#u=e;}async track(e){if(!this.isEnabled())return;let t={...e,timestamp:new Date().toISOString(),payload:e.payload??{}},n=Jr(t);this.#a.push(t),await Promise.allSettled([this.#v(n),this.flush()]);}async flush(){if(!this.#a.length)return;if(this.#n){await this.#n;return}let e=this.#a.splice(0);this.#n=this.#C(e).finally(()=>{this.#n=void 0;}),await this.#n;}async#y(){await Promise.allSettled([this.flush(),this.#F()]);}#w(){if(!this.isEnabled())return;let e=process.env[Rr]??zr;if(e)try{let t=process.env[$r]??qr;return new PostHog(e,{host:t})}catch(t){this.#t.debug(`posthog init failed: ${String(t)}`);return}}async#h(){this.#m||(this.#m=Te());try{return await this.#m}catch{return}}#D(){let e=this.#e.getLicense();return e?{userId:qi(e),userType:"paid"}:{userType:"free"}}#b(){if(this.#g)return;let e=()=>{this.#y();};process.once("beforeExit",e),process.once("exit",e),process.once("SIGINT",e),process.once("SIGTERM",e),this.#g=true;}async#C(e){if(!e.length)return;this.#i??=this.#e.getTelemetryId();let t=this.#i,n=await this.#h(),o=this.#D(),s=[...e.map(a=>Jr(a))];for(;s.length;){let a=[],u;for(;s.length&&a.length<Wi;){let c=s[0];if(!c)break;let l=[...a,c],d=this.#E(l,t,{hugoVersion:n,userInfo:o}),p=JSON.stringify(d);if(Buffer$1.byteLength(p,"utf8")>Xr){if(!a.length){s.shift(),this.#t.warn("Dropped telemetry event because payload exceeded max size");continue}break}let m=s.shift();if(!m)break;a.push(m),u=p;}!a.length||!u||await this.#S(u,t);}}async#v(e){if(this.#o)try{let t=await this.#h(),n=this.#x(e,t);await this.#o.capture({distinctId:this.#i??"anonymous",event:e.name,timestamp:new Date(e.timestamp),properties:n});}catch(t){this.#t.debug(`posthog capture failed: ${String(t)}`);}}#x(e,t){let n=e.payload??{},o=typeof n.command=="string"?n.command:this.#u,i=this.#D();return {...n,command:o,product_area:"cli",platform:"terminal",os:Re.platform(),os_version:Kr(),arch:process.arch,node_version:process.version,os_arch:this.#f,hugo_version:t,ci:Yr(),release_channel:this.#c,session_id:this.#l,cli_version:this.#r,cli_name:this.#d,language:this.#p,locale:this.#s,has_license:!!this.#e.getLicense(),user_id:i.userId,user_type:i.userType}}#E(e,t,n){return {clientId:t&&t.length>=8?t:"anonymous",os:Re.platform(),osVersion:Kr(),arch:process.arch,nodeVersion:process.version,ci:Yr(),command:this.#u,releaseChannel:this.#c,sessionId:this.#l,cliVersion:this.#r,version:this.#r,hasLicense:!!this.#e.getLicense(),cliName:this.#d,osArch:this.#f,hugoVersion:n.hugoVersion,userId:n.userInfo.userId,userType:n.userInfo.userType,language:this.#p,locale:this.#s,events:e}}async#F(){if(this.#o)try{let e=this.#o;if(typeof e.flushAsync=="function"){await e.flushAsync();return}if(typeof e.shutdownAsync=="function"){await e.shutdownAsync();return}typeof e.shutdown=="function"&&await e.shutdown();}catch(e){this.#t.debug(`posthog flush failed: ${String(e)}`);}}async#S(e,t){let n=Buffer$1.byteLength(e,"utf8");if(n>Xr){this.#t.warn("Telemetry payload skipped because it exceeded the maximum request size");return}try{let o=new AbortController,i=setTimeout(()=>o.abort(),5e3),s=await fetch(Ir,{method:"POST",headers:{"Content-Type":"application/json","Content-Length":String(n),"User-Agent":`hbx-cli/${this.#r}`,...t?{"x-telemetry-id":t}:void 0},body:e,signal:o.signal});if(clearTimeout(i),s.status===413){this.#t.warn("Telemetry payload rejected (too large)");return}if(!s.ok)throw new Error(`telemetry responded with status ${s.status}`)}catch(o){this.#t.debug(`telemetry send failed: ${String(o)}`);}}};function Yr(){return process.env.CI==="1"||process.env.CONTINUOUS_INTEGRATION==="1"||!!process.env.BUILD_NUMBER||!!process.env.RUN_ID}function Kr(){let r=Re.version;if(typeof r=="function")try{return r()}catch{return Re.release()}return Re.release()}function Jr(r){let e=zi(r.payload);if(!e){let{payload:t,...n}=r;return n}try{let t=JSON.stringify(e);return Buffer$1.byteLength(t,"utf8")>Gi?{...r,payload:{truncated:!0}}:{...r,payload:e}}catch{return {...r,payload:{truncated:true}}}}function zi(r){if(!r||typeof r!="object")return;let e={};for(let t of Ui)if(Object.hasOwn(r,t)){let n=r[t];if(t==="metadata"&&(n==null||typeof n!="object"))continue;e[t]=t==="metadata"?Zr(n):n;}return Object.keys(e).length?e:void 0}function Zr(r){let e={};for(let[t,n]of Object.entries(r)){let o=en(t,n);o!==void 0&&(e[t]=o);}return e}function en(r,e){return e==null?e:typeof e=="string"?Vi.has(r)?e:"[redacted]":Array.isArray(e)?e.map(t=>en(r,t)):typeof e=="object"?Zr(e):e}function qi(r){return createHash("sha256").update(r).digest("hex")}function Xi(){try{let e=new Intl.DateTimeFormat().resolvedOptions().locale,t=Qr(e);if(t)return t}catch{}let r=process.env.LC_ALL??process.env.LC_MESSAGES??process.env.LANG??process.env.LANGUAGE;return Qr(r)}function Yi(r){if(r)return r.split("-")[0]??r}function Qr(r){if(!r)return;let e=r.trim();if(!e)return;let n=(e.split(/[.:]/)[0]??e).replace("_","-");try{return new Intl.Locale(n).toString()}catch{return /^[a-zA-Z]{2,3}(-[a-zA-Z]{2,4})?/.test(n)?n:void 0}}function X(r){return at(r)?{errorCode:r.code,errorMessage:r.message}:r instanceof Error?{errorCode:"UNKNOWN_ERROR",errorMessage:r.message}:{errorCode:"UNKNOWN_ERROR",errorMessage:String(r)}}function nn(r){let e=r.match(/github\.com[/:]([\w-]+)\/([\w-]+?)(?:\.git)?$/i);return e?{owner:e[1],repo:e[2]}:null}function Ki(r){return nn(r)!==null}async function Ji(r,e){try{let n=(await Dt(`${r}/${e}`,"hugoblox/themes")).filter(o=>o.type==="file"&&o.name.toLowerCase().endsWith(".yaml"));if(n.length===0)throw new y(`No theme files found in hugoblox/themes directory at https://github.com/${r}/${e}`);return n.map(o=>({name:o.name,downloadUrl:o.download_url}))}catch(t){if(t instanceof y)return Promise.reject(t);throw t.message==="Directory not found"?new y(`Repository does not contain a 'hugoblox/themes' directory. Please check the repository structure at https://github.com/${r}/${e}`):new y(`Failed to fetch themes from GitHub: ${t instanceof Error?t.message:String(t)}`)}}async function Qi(r,e,t,n){let o=await ht(`${r}/${e}`,`hugoblox/themes/${t}`);if(!o)throw new y(`Failed to download theme file: ${t}`);await _(n,o);}async function Zi(r,e){let t=k.join(r,"config","_default","params.yaml");if(!await C(t))throw new y(`params.yaml not found at ${t}. Please ensure you're in a HugoBlox site.`);let n=await H.readFile(t,"utf8"),o=gr.parse(n),i=typeof o=="object"&&o!==null?o:{};(typeof i.hugoblox!="object"||i.hugoblox===null)&&(i.hugoblox={});let s=i.hugoblox;(typeof s.theme!="object"||s.theme===null)&&(s.theme={}),s.theme.pack=e;let a=gr.stringify(i);await H.writeFile(t,a,"utf8");}function de(r){return r.toLowerCase().replace(/\.yaml$/i,"")}function on(r,e){r.command("theme").description("Add theme pack(s) from a GitHub repository").option("--repo <url>","GitHub repository URL containing themes").option("--theme <name>","Specific theme filename to download (without .yaml), or 'all' for all themes").option("--set-active","Set the downloaded theme as active in params.yaml").option("--no-set-active","Skip setting theme as active").option("--ci","Run in non-interactive mode").action(async(t,n)=>{let o=Date.now(),{logger:i,telemetry:s}=e,a=!!n.optsWithGlobals().json;try{let u=await j();if(!u)throw new y("Not in a HugoBlox site. Please run this command from within a HugoBlox site directory (must contain hugoblox.yaml)");let c=u.root,l=t.repo;if(!l){if(t.ci)throw new y("--repo is required when running with --ci");l=await q("Enter the GitHub repository URL containing themes (e.g., https://github.com/username/themes-repo):");}if(l=l.trim(),!Ki(l))throw new y("Invalid GitHub repository URL. Please provide a valid GitHub URL (e.g., https://github.com/owner/repo)");let d=nn(l);if(!d)throw new y("Failed to parse GitHub URL");let{owner:p,repo:m}=d,f=p,g=Bt("Fetching available themes...").start(),D;try{D=await Ji(p,m),g.succeed(`Found ${D.length} theme(s)`);}catch(A){throw g.fail("Failed to fetch themes"),A}let h,b=t.theme;if(!b)if(t.ci)b="all";else {let A=[{title:"All themes",value:"all"},...D.map(x=>({title:de(x.name),value:x.name}))];b=await qe("Which theme(s) do you want to download?",A);}if(b.toLowerCase()==="all")h=D;else {let A=de(b),w=D.find(x=>de(x.name)===A);if(!w)throw new y(`Theme '${b}' not found. Available themes: ${D.map(x=>x.name).join(", ")}`);h=[w];}let F=k.join(c,"data","themes",f);await M(F);let S=Bt(`Downloading ${h.length} theme(s)...`).start();try{for(let A of h){let w=k.join(F,A.name);await Qi(p,m,A.name,w);}S.succeed(`\u2705 Downloaded ${h.length} theme(s) to data/themes/${f}/`);}catch(A){throw S.fail("Failed to download themes"),A}let T=!1,B=null;if((t.setActive||t.setActive!==!1&&!t.noSetActive)&&(t.ci?h.length===1&&(T=!0,B=de(h[0].name)):(T=await O("Do you want to set one of these themes as active?",{initial:h.length===1}),T&&(h.length===1?B=de(h[0].name):B=await qe("Which theme do you want to activate?",h.map(w=>({title:de(w.name),value:de(w.name)})))))),T&&B){let A=`${f}/${B}`,w=Bt("Updating params.yaml...").start();try{await Zi(c,A),w.succeed(`\u2705 Set active theme to: ${A}`);}catch(x){throw w.fail("Failed to update params.yaml"),x}}let Q=Date.now()-o;if(await s.track({name:"add-theme",payload:{status:"success",duration:Q,metadata:{vendor:f,themesCount:h.length,activated:T,ci:!!t.ci}}}),a){i.json({status:"success",vendor:f,themes:h.map(A=>A.name),activated:B?`${f}/${B}`:null});return}i.success(`
\u{1F3A8} Themes installed successfully!`),(!T||!B)&&(i.info(`
\u{1F4DD} To use a theme, update your config/_default/params.yaml:`),i.info(`
hugoblox:`),i.info("  theme:"),i.info(`    pack: "${f}/${de(h[0].name)}"`));}catch(u){let c=X(u),l=Date.now()-o;if(await s.track({name:"add-theme",payload:{status:"error",duration:l,errorCode:c.errorCode,errorMessage:c.errorMessage,metadata:{ci:!!t.ci}}}),a){i.json({status:"error",message:u instanceof Error?u.message:String(u)});return}throw u}});}function sn(r,e){let t=r.command("add").description("Add resources (themes)");on(t,e);}function an(r,e){r.command("block").argument("<id>","Block identifier").description("Create a new HugoBlox block").option("--example <slug>","Include sample content for the block").option("--dry-run","Print the actions without writing files").option("--yes","Overwrite files when they already exist").action((t,n,o)=>{let{logger:i}=e,s=!!o.optsWithGlobals().json,a="Block creation is coming soon. Follow Discord for updates or to preview it early.";if(s){i.json({status:"pending",message:a});return}i.info(a);});}var qt="com.hugoblox.cli",rs=1,ns=createRequire(import.meta.url),os=promisify(Xe.scrypt),re=null;try{re=ns("keytar");}catch{re=null;}async function un(r,e,t,n,o){let i=`device:${t}`,s,a;if(re)await re.setPassword(qt,i,n);else {let u=await as(n,e);s=u.payload,a=u.salt;}r.setDeviceInfo({id:t,label:o,secretAlias:re?i:void 0,secretFallback:s,secretFallbackSalt:a,secretFallbackVersion:s?rs:void 0}),await r.save();}async function cn(r,e){let t=r.getDeviceInfo();if(!t?.id)return;let n;if(t.secretAlias&&re&&(n=await re.getPassword(qt,t.secretAlias)),!n&&t.secretFallback&&t.secretFallbackSalt)try{let{key:o}=await ln(e,t.secretFallbackSalt);n=ss(t.secretFallback,o);}catch{n=void 0;}if(n)return {id:t.id,secret:n,label:t.label}}async function Xt(r){let e=r.getDeviceInfo();e?.secretAlias&&re&&await re.deletePassword(qt,e.secretAlias),r.setDeviceInfo(void 0),await r.save();}function is(r,e){let t=Xe.randomBytes(12),n=Xe.createCipheriv("aes-256-gcm",e.subarray(0,32),t),o=Buffer.concat([n.update(r,"utf8"),n.final()]),i=n.getAuthTag();return Buffer.concat([t,i,o]).toString("base64")}function ss(r,e){let t=Buffer.from(r,"base64"),n=t.subarray(0,12),o=t.subarray(12,28),i=t.subarray(28),s=Xe.createDecipheriv("aes-256-gcm",e.subarray(0,32),n);return s.setAuthTag(o),Buffer.concat([s.update(i),s.final()]).toString("utf8")}async function ln(r,e){let t=Buffer.from(e,"base64");return {key:await os(r,t,32,{N:32768,r:8,p:1,maxmem:64*1024*1024}),salt:e}}async function as(r,e){let t=Xe.randomBytes(16).toString("base64"),{key:n}=await ln(e,t);return {payload:is(r,n),salt:t}}async function Y(r,e={}){let t=r.config.getLicense();if(!t)throw new y("Set HBX_LICENSE_TOKEN or run 'hbx login' to access Pro content.");let n=await r.config.ensureTelemetryId();if(e.force)await Xt(r.config);else {let s=await cn(r.config,n);if(s)return {id:s.id,secret:s.secret}}let o=e.label??Re.hostname(),i=await cs(r.config,t,n,o);return await un(r.config,n,i.deviceId,i.deviceSecret,o),r.logger.debug(`Registered device ${i.deviceId}`),{id:i.deviceId,secret:i.deviceSecret}}async function dn(r){await Xt(r);}async function cs(r,e,t,n){let o=await fetch(`${he}/api/license/devices/register`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","x-telemetry-id":t},body:JSON.stringify({deviceLabel:n})}),i=await ls(o);if(!o.ok)throw i?.code==="license_device_limit"?new y("This license has reached the maximum number of devices. Revoke an existing device and try again."):o.status===401||o.status===403?new y(i?.error??"Unable to register device"):new y(i?.error??`Device registration failed (status ${o.status})`);if(!i?.deviceId||!i?.deviceSecret)throw new y("Device registration response was missing credentials");return i}async function ls(r){try{return await r.json()}catch{return}}function ds(r){return r.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}async function fe(r){let{logger:e}=r,t=await fs(e),n=await ms(r);return t.length||n.length?[...n,...t]:Ot}async function fs(r){try{return (await Dt("HugoBlox/hugo-blox-builder","templates")).filter(n=>n.type==="dir").map(n=>({id:n.name,name:ds(n.name),description:`Starter template ${n.name}`,repoPath:n.path,slug:n.name,source:"oss"}))}catch(e){return r?.debug?.(`Falling back to offline starter metadata: ${String(e)}`),Ot}}async function ms(r){let{logger:e,config:t}=r,n=new Headers({"User-Agent":"hbx-cli"});try{let a=await t.ensureTelemetryId();n.set("x-telemetry-id",a);}catch{}let o,i=t.getLicense();if(i)try{let a=await Y(r);o=new Headers(n),o.set("Authorization",`Bearer ${i}`),o.set("X-HBX-Device-Id",a.id),o.set("X-HBX-Device-Secret",a.secret);}catch(a){e?.debug?.(`Skipping device-auth headers for Pro templates: ${String(a)}`);}let s=[];o&&s.push({label:"with auth",headers:o}),s.push({label:o?"without auth":"anonymous",headers:n});for(let a of s)try{let u=await fetch(`${he}/api/pro-templates`,{headers:a.headers});if(!u.ok)throw new Error(`catalog responded with status ${u.status}`);return (await u.json()).templates.map(l=>({id:l.id,name:`${l.name} (Pro)`,description:l.description??void 0,repoPath:void 0,slug:l.slug??l.id,source:"pro",version:l.version,sizeBytes:l.sizeBytes,updatedAt:l.updatedAt,commitHash:l.commitHash,downloadEndpoint:l.downloadUrl}))}catch(u){e.debug(`Unable to fetch Pro template catalog (${a.label}): ${String(u)}`);}return []}async function Ye(r,e,t={}){try{await execa("git",["init"],{cwd:r}),await execa("git",["add","."],{cwd:r}),await execa("git",["commit","-m","chore: initialize site"],{cwd:r,reject:!1}),e.success(`Initialized git repository in ${k.relative(process.cwd(),r)||"."}`);}catch(n){if(t.strict)throw new Error(`Git initialization failed: ${String(n)}`);e.warn(`Git initialization skipped: ${String(n)}`);}}async function Kt(r,e,t={},n=0){let o=r.config.getLicense();if(!o)throw new y("A HugoBlox Pro license key is required before accessing Pro templates.");let i=await r.config.ensureTelemetryId(),s=await Y(r,{force:n>0}),a=new Headers(t.headers??{});a.set("Authorization",`Bearer ${o}`),a.set("X-HBX-Device-Id",s.id),a.set("X-HBX-Device-Secret",s.secret),a.set("X-Telemetry-Id",i);let u=await fetch(`${he}${e}`,{...t,headers:a});if((u.status===401||u.status===403)&&n===0)return await Y(r,{force:true}),Kt(r,e,t,n+1);if(!u.ok){let c=await gs(u);throw c?.code==="license_device_limit"?new y("This license has reached the maximum number of devices. Revoke an existing device and try again."):u.status===401||u.status===403?new y(c?.error??"Device authentication failed."):new y(c?.error??`Request failed (${u.status})`)}return u}async function gs(r){try{return await r.json()}catch{return}}var hs=3;async function wt(r,e,t,n){if(e.source==="pro"){await ws(r,e,t,n);return}let o=process.env[Hr];if(o){await Ds(e,o,t),n.debug(`Hydrated template ${e.id} from local override`);return}let i=await yt("HugoBlox/hugo-blox-builder",e.repoPath??""),s=i?.sha?k.join(Ae,e.id,i.sha):void 0;if(s&&await C(s)){await be(s,t),n.debug(`Hydrated template ${e.id} from cache (${i?.sha})`);return}let a=await H.mkdtemp(k.join(Re.tmpdir(),"hbx-template-")),u=k.join(a,"repo");try{await execa("git",["clone","--depth","1",_r,u],{stdio:"ignore"});let c=await ys(u,e);s?(await M(k.dirname(s)),await H.rm(s,{recursive:!0,force:!0}),await H.cp(c,s,{recursive:!0}),await pn(k.join(Ae,e.id)),await be(s,t),n.debug(`Hydrated template ${e.id} from fresh cache (${i?.sha})`)):(await be(c,t),n.debug(`Hydrated template ${e.id} from repository`));}catch(c){throw new y("Failed to clone HugoBlox templates. Ensure git is installed and accessible.",{error:c})}finally{await H.rm(a,{recursive:true,force:true});}}async function Ds(r,e,t){let n=k.join(e,r.id);try{await H.access(n);}catch(o){throw new y(`Local template not found at ${n}`,{error:o})}await be(n,t);}async function ys(r,e){let t=e.repoPath??"",n=k.join(r,t);return await H.access(n),n}async function be(r,e){await H.rm(e,{recursive:true,force:true}),await M(k.dirname(e)),await H.cp(r,e,{recursive:true}),await H.rm(k.join(e,".git"),{recursive:true,force:true});}async function pn(r){if(!await C(r))return;let e=await H.readdir(r,{withFileTypes:true}),t=await Promise.all(e.filter(n=>n.isDirectory()).map(async n=>{let o=k.join(r,n.name),i=await H.stat(o);return {path:o,mtimeMs:i.mtimeMs}}));t.sort((n,o)=>o.mtimeMs-n.mtimeMs);for(let n of t.slice(hs))await H.rm(n.path,{recursive:true,force:true});}async function ws(r,e,t,n){let o=e.version?k.join(Ae,e.id,e.version):void 0;if(o&&await C(o)){await be(o,t),n.debug(`Hydrated Pro template ${e.id} from cache (${e.version})`);return}let i=await H.mkdtemp(k.join(Re.tmpdir(),"hbx-pro-template-")),s=k.join(i,"template.tgz"),a=k.join(i,"extract");await M(a);try{let u=await bs(r,e,s);await execa("tar",["-xzf",s,"-C",a]);let c=await Cs(a,e.slug),l=e.version??u.version??void 0,d=l!==void 0?k.join(Ae,e.id,l):void 0;d?(await M(k.dirname(d)),await H.rm(d,{recursive:!0,force:!0}),await H.cp(c,d,{recursive:!0}),await pn(k.join(Ae,e.id)),await be(d,t),n.debug(`Hydrated Pro template ${e.id} from fresh cache (${l})`)):(await be(c,t),n.debug(`Hydrated Pro template ${e.id} from archive`));}catch(u){throw new y(`Failed to download Pro template ${e.name}. Ensure your license is valid and try again.`,{error:u})}finally{await H.rm(i,{recursive:true,force:true});}}async function bs(r,e,t){let n=e.downloadEndpoint??`/api/pro-templates/${encodeURIComponent(e.id)}/download`,o=await Kt(r,n),i=await vs(o);if(!i?.url)throw new y("Pro template download URL was missing");let s=await fetch(i.url);if(!s.ok)throw new y(`Pro template archive download failed (${s.status})`);let a=Buffer.from(await s.arrayBuffer());return await H.writeFile(t,new Uint8Array(a)),{version:i.version}}async function Cs(r,e){let t=await H.readdir(r,{withFileTypes:true}),n=t.find(i=>i.isDirectory()&&i.name===e);if(n)return k.join(r,n.name);let o=t.filter(i=>i.isDirectory());return o.length===1?k.join(r,o[0].name):r}async function vs(r){try{return await r.json()}catch{return}}var gn="https://hugoblox.com/discord",hn="https://docs.hugoblox.com",Dn="https://hugoblox.com/pro";function ne(r){return r.trim().toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"").slice(0,64)}async function bt(r,e,t,n){let{logger:o}=r;await wt(r,t,e,o),await Es(e,t,n),n.sampleContent||await Ss(e,t);}async function Ct(r,e,t){t.info(`\u{1F4E6} Installing dependencies with ${e}...`);let n={...process.env},o=["install"],i=!t.isJsonMode();e==="pnpm"&&(n.PNPM_WORKSPACE_DIR=r,n.PNPM_IGNORE_WORKSPACE_ROOT_CHECK="1",await xs(r),o.push("--no-link-workspace-packages"));try{return await execa(e,o,{cwd:r,stdio:i?"ignore":"inherit",env:n}),t.success("\u2705 Dependencies installed"),!0}catch(s){return i?t.warn(`\u26A0\uFE0F  Failed to install dependencies automatically. Run ${e} install inside ${r}`):t.warn(`\u26A0\uFE0F  Failed to install dependencies automatically: ${String(s)}`),false}}async function xs(r){let e=k.join(r,"pnpm-workspace.yaml");if(await C(e))return;await _(e,`packages:
  - './*'
`);}async function bn(r,e,t){t.info("\u{1F525} Starting dev server with Hugo (press Ctrl+C to exit)...");let n={...process.env};e==="pnpm"&&(n.PNPM_WORKSPACE_DIR=r);try{await execa(e,["dev"],{cwd:r,stdio:"inherit",env:n}),t.success("\u2705 Dev server stopped");}catch(o){let i=o;if(i.signal==="SIGINT"||i.signal==="SIGTERM"){t.info("\u2705 Dev server stopped");return}if(o?.code==="ENOENT"||/[hH]ugo/.test(String(i.stderr))){t.error("Hugo executable not found. Install Hugo (https://docs.hugoblox.com/start/cli) or deploy with the Copilot at https://hugoblox.com/templates/");return}throw t.error(`Dev server exited with an error: ${String(o)}`),o}}async function Es(r,e,t){let n=ne(k.basename(r))||e.slug;await Fs(r,n);let o={"README.md":`# ${e.name}

This site was created with the HugoBlox CLI.
`,".gitignore":`node_modules
.cache
.env
public
.DS_Store
modules/_vendor
`};t.includeEnv&&(o[".env"]=`# HBX environment variables
HBX_LICENSE_TOKEN=
`);for(let[i,s]of Object.entries(o)){let a=k.join(r,i);await C(a)||await _(a,s);}}async function Fs(r,e){let t=k.join(r,"package.json"),n={name:e,private:true,scripts:{dev:"hugo server -D",build:"hugo --gc --minify",lint:"echo 'TODO: add lint script'"},dependencies:{}};if(!await C(t)){await _(t,JSON.stringify(n,null,2));return}try{let o=await H.readFile(t,"utf8"),i=JSON.parse(o),s={...n,...i,name:e,scripts:{...n.scripts,...i.scripts},dependencies:{...n.dependencies,...i.dependencies}};await _(t,JSON.stringify(s,null,2));}catch{await _(t,JSON.stringify(n,null,2));}}async function Ss(r,e){let t=k.join(r,"content");await H.rm(t,{recursive:true,force:true}),await M(k.dirname(k.join(t,"_index.md"))),await _(k.join(t,"_index.md"),ks(e));}function ks(r){return `---
title: "${r.name}"
type: landing
design:
  spacing: "5rem"

sections:
  - block: hero
    content:
      eyebrow: "You're live on HugoBlox"
      title: "Great job launching ${r.name}"
      text: "Start customizing blocks to launch your next experience."
      primary_action:
        text: "Join our Discord"
        url: "${gn}"
        icon: "chat-bubble-left-right"
      secondary_action:
        text: "Upgrade to Pro"
        url: "${Dn}"
      tertiary_action:
        text: "View Docs"
        url: "${hn}"
    design:
      css_class: "bg-gradient-to-r from-blue-600 to-indigo-600 text-white"
      spacing:
        padding: ["4rem", 0, "4rem", 0]
  - block: markdown
    content:
      title: "Your next steps"
      text: |
        1. Join the community on [Discord](${gn}) for support and inspiration.
        2. Explore the [documentation](${hn}) to learn how to add blocks, deploy, and automate.
        3. [Upgrade to Pro](${Dn}) to unlock premium blocks, design systems, and automation-ready packages.
        4. Share feedback and showcase your build to help the ecosystem grow.
`}function Jt(r){return r?r.length<=6?"***":`${r.slice(0,3)}***${r.slice(-2)}`:"(none)"}function vt(r,e){let t=r??e;return k.resolve(process.cwd(),t)}async function Cn(r=process.cwd()){let e=k.join(r,"pnpm-lock.yaml"),t=k.join(r,"yarn.lock"),n=k.join(r,"package-lock.json");return oe.existsSync(e)?"pnpm":oe.existsSync(t)?"yarn":oe.existsSync(n)?"npm":"pnpm"}async function xt(r){try{let e=k.resolve(r);if(r.includes("\0")||/[<>:"|?*]/.test(r))return {valid:!1,exists:!1,isEmpty:!1,writable:!1,error:"Path contains invalid characters"};let t=!1,n=!1,o=!1;try{let i=oe.statSync(e);if(t=!0,i.isDirectory()){n=oe.readdirSync(e).length===0;try{oe.accessSync(e,oe.constants.W_OK),o=!0;}catch{o=!1;}}else return {valid:!1,exists:!0,isEmpty:!1,writable:!1,error:"Path exists but is not a directory"}}catch{let s=k.dirname(e);try{oe.accessSync(s,oe.constants.W_OK),o=!0;}catch{return {valid:!1,exists:!1,isEmpty:!1,writable:!1,error:"Parent directory is not writable"}}}return {valid:!0,exists:t,isEmpty:n,writable:o}}catch(e){return {valid:false,exists:false,isEmpty:false,writable:false,error:e instanceof Error?e.message:"Unknown error"}}}function Bs(r,e){if(!e)return;let t=e.toLowerCase(),n=r.find(o=>{let i=o.id.toLowerCase(),s=o.slug?.toLowerCase();return i===t||s===t});if(n)return n;if(e.startsWith("http")||e.startsWith("git@"))return {id:e,name:"Custom template",description:`External template: ${e}`,repoPath:e,slug:"custom",source:"custom"}}function En(r,e){r.command("site").description("Create a new HugoBlox site").argument("[dir]","Target directory (defaults to template slug, e.g., new-site)").option("--template <id>","Starter template ID").option("--dir <path>","Target directory").option("--package-manager <name>","Package manager","pnpm").option("--no-install","Skip dependency installation").option("--git","Initialize a git repository").option("--ci","Run in non-interactive mode").option("--sample-content","Force include sample content").option("--no-sample-content","Skip sample content").option("--pro","Mark the project as Pro ready").option("--preview","Automatically start the dev server after setup").option("--no-preview","Skip the dev server prompt").action(async(t,n,o)=>{let i=Date.now(),{logger:s,config:a,telemetry:u}=e,l=!!o.optsWithGlobals().json,d=Bt({text:"Fetching templates...",spinner:"dots"}).start(),p=await fe(e).finally(()=>{d.succeed("\u2728 Templates ready");}),m=Bs(p,n.template),f=m;try{if(!f){if(n.ci)throw new y("Template must be specified when running with --ci");let w=await qe("Select a starter",p.map(x=>({title:x.name,description:x.description,value:x.id})));f=p.find(x=>x.id===w);}if(!f)throw new y("Unable to determine template");let g=f.source==="pro",D=await Rs(n,t,f),h=vt(D,f.slug);await ct(h);let b=typeof n.sampleContent=="boolean"?n.sampleContent:typeof n.noSampleContent=="boolean"?!n.noSampleContent:n.ci?!1:await O("Include sample content? (recommended)",{initial:!0}),F=g;if(!g)F=typeof n.pro=="boolean"?n.pro:n.ci?!1:await O("Do you have a HugoBlox Pro license?",{initial:!!a.getLicense()});else if(!a.getLicense()){if(n.ci)throw new y(`"${f.name}" is a HugoBlox Pro template. Set HBX_LICENSE_TOKEN with your license key before running in CI.`);if(s.info(`"${f.name}" is part of HugoBlox Pro. Purchase a license at https://hugoblox.com/pro to receive your key via email (powered by Lemon Squeezy).`),!await O("Do you have a HugoBlox Pro license key to enter now?",{initial:!0}))throw new y("Pro templates require an active license. Purchase at https://hugoblox.com/pro and rerun this command after running 'hbx login' or setting HBX_LICENSE_TOKEN.");let x=await xn(a.getLicense());a.setLicense(x),await a.save();}if(!g&&F&&!a.getLicense()){if(n.ci)throw new y("Set HBX_LICENSE_TOKEN before running --ci when enabling Pro features.");let w=await xn(a.getLicense());a.setLicense(w),await a.save();}F&&await Y(e);let S=!1;if(l||n.ci){let w=Bt(`Creating site in ${k.relative(process.cwd(),h)||"."}...`).start();try{await bt(e,h,f,{sampleContent:b,includeEnv:!0,packageManager:n.packageManager??"pnpm"}),w.succeed("Files generated");}catch(x){throw w.fail("Failed to scaffold site"),x}n.install!==!1?S=await Ct(h,n.packageManager??"pnpm",s):s.info("Skipping dependency installation"),n.git&&await Ye(h,s);}else S=await Ms({context:e,targetDir:h,template:f,includeSample:b,packageManager:n.packageManager??"pnpm",shouldInstall:n.install!==!1,shouldInitGit:n.git??!1});let T={status:"success",template:f.id,path:h,pro:F,manifest:k.join(h,pt)};!S&&n.preview?s.warn("\u26A0\uFE0F  Cannot start the dev server because dependencies failed to install."):n.install===!1&&n.preview&&s.warn("\u26A0\uFE0F  Install dependencies first (skip --no-install) to start the dev server automatically.");let B=!1;S&&(B=await Ts(n,l));let Q=Date.now()-i,A={templateId:f.id,sample:b,pro:F,ci:!!n.ci,packageManager:n.packageManager??"pnpm",install:n.install!==!1,dependenciesReady:S,preview:B};if(await u.track({name:"new-site",payload:{status:"success",duration:Q,metadata:A}}),B){await bn(h,n.packageManager??"pnpm",s);return}if(l){s.json(T);return}s.success(`\u2705 Site created at ${h}`),s.info("\u{1F680} Next steps:"),s.info(`  \u{1F449} cd ${k.relative(process.cwd(),h)||h}`),n.install===!1&&s.info(`  \u{1F449} ${n.packageManager??"pnpm"} install`),s.info("  \u{1F449} pnpm dev");}catch(g){let D=X(g),h=Date.now()-i;throw await u.track({name:"new-site",payload:{status:"error",duration:h,errorCode:D.errorCode,errorMessage:D.errorMessage,metadata:{templateId:f?.id??m?.id??n.template,ci:!!n.ci}}}),g}});}async function Ts(r,e){return e||r.ci?false:typeof r.preview=="boolean"?r.preview:r.noPreview?false:O("Start the dev server now?",{initial:true})}async function Rs(r,e,t){if(r.dir)return r.dir;if(e)return e;if(r.ci)return t.slug;let o=(await q("Project folder name",{initial:t.slug})).trim();return o?$s(o)?o:ne(o)||t.slug:t.slug}function $s(r){return /[\\/]/.test(r)||r.includes(":")}async function xn(r){let t=(await q("Enter your HugoBlox Pro license key (from your purchase confirmation email)",{initial:r??""})).trim();if(!t)throw new y("A HugoBlox Pro license key is required to continue. Check your purchase email or visit https://hugoblox.com/pro.");return t}async function Ms(r){let{context:e,targetDir:t,template:n,includeSample:o,packageManager:i,shouldInstall:s,shouldInitGit:a}=r,{logger:u}=e,c=false,l=new Listr([{title:"Creating HugoBlox site",task:(d,p)=>p.newListr([{title:`Download template: ${n.name}`,task:async()=>{await wt(e,n,t,u);}},{title:"Generate project structure",task:async()=>{let m=ne(k.basename(t))||n.slug,f=k.join(t,"package.json");await C(f)||await _(f,JSON.stringify({name:m,private:true,scripts:{dev:"hugo server -D",build:"hugo --gc --minify",lint:"echo 'TODO: add lint script'"},dependencies:{}},null,2));}},{title:"Create baseline files",task:async()=>{let m={"README.md":`# ${n.name}

This site was created with the HugoBlox CLI.
`,".gitignore":`node_modules
.cache
.env
public
.DS_Store
modules/_vendor
`,".env":`# HBX environment variables
HBX_LICENSE_TOKEN=
`};for(let[f,g]of Object.entries(m)){let D=k.join(t,f);await C(D)||await _(D,g);}}},{title:o?"Setup sample content":"Create minimal landing page",task:async()=>{}}],{concurrent:false,rendererOptions:{collapseSubtasks:false}})},{title:"Installing dependencies",enabled:()=>s,task:async(d,p)=>{let m={...process.env},f=["install"];if(i==="pnpm"){m.PNPM_WORKSPACE_DIR=t,m.PNPM_IGNORE_WORKSPACE_ROOT_CHECK="1";let g=k.join(t,"pnpm-workspace.yaml");await C(g)||await _(g,`packages:
  - './*'
`),f.push("--no-link-workspace-packages");}p.title=`Installing dependencies with ${i}`;try{await execa(i,f,{cwd:t,env:m}),c=!0;}catch(g){throw p.title="Failed to install dependencies",g}}},{title:"Initialize git repository",enabled:()=>a,task:async()=>{await Ye(t,u);}}],{rendererOptions:{collapseSubtasks:false,showTimer:true}});try{return await l.run(),u.success("\u2705 Site created successfully"),c}catch(d){throw u.error(`Failed to create site: ${d instanceof Error?d.message:String(d)}`),d}}var js=fileURLToPath(import.meta.url),Qt=k.dirname(js);function Os(){return Qt.endsWith("dist")?k.join(Qt,"lib","templates","minimal-theme.yaml"):k.resolve(Qt,"..","lib","templates","minimal-theme.yaml")}var Fn=Os();function Ls(r){return /^[a-zA-Z0-9_-]+$/.test(r)}async function Ns(){try{return await H.readFile(Fn,"utf8")}catch(r){throw new y(`Failed to load theme template: ${Fn}`,{error:r})}}function Us(r,e,t,n){let o=r.split(`
`),i=[],s=false,a=0;for(let u of o){if(u.trim()==="meta:"){s=true,a=u.indexOf("meta:"),i.push(u),i.push('    format: "hugoblox-theme@1"'),i.push(`    name: "${t}"`),i.push(`    vendor: "${e}"`),i.push('    version: "0.0.1"'),i.push('    license: "MIT"'),i.push('    description: "Created via HugoBlox CLI"');continue}if(s){u.trim()&&!u.startsWith(" ".repeat(a+2))&&u.indexOf(":")>0&&(s=false,i.push(u));continue}i.push(u);}return i.join(`
`)}function Sn(r,e){r.command("theme").description("Scaffold a new theme pack").argument("[name]","Theme slug/filename (will be converted to kebab-case)").option("--vendor <namespace>","Vendor namespace (e.g., GitHub username)").option("--theme-name <name>","Human-readable theme name (defaults to slug)").option("--git","Initialize a git repository").option("--ci","Run in non-interactive mode").action(async(t,n,o)=>{let i=Date.now(),{logger:s,telemetry:a}=e,u=!!o.optsWithGlobals().json;try{let c=n.vendor;if(!c){if(n.ci)throw new y("--vendor is required when running with --ci");c=await q("What is your GitHub username? (This will be your vendor namespace)");}if(c=c.trim(),!c)throw new y("Vendor namespace is required");if(!Ls(c))throw new y("Vendor namespace must contain only alphanumeric characters, hyphens, and underscores");let l=t;if(!l){if(n.ci)throw new y("Theme slug is required when running with --ci");l=await q("What do you want to name your theme? (e.g., cyberpunk-neon)",{initial:"my-theme"});}if(l=l.trim(),!l)throw new y("Theme slug is required");let d=ne(l),p=n.themeName;p||(n.ci?p=l:p=await q("Human-readable theme name?",{initial:l})),p=p.trim()||l;let m=k.join(process.cwd(),"data","themes",c),f=k.join(m,`${d}.yaml`);if(await C(f)){if(n.ci)throw new y(`Theme file already exists: ${f}`);if(!await O(`Theme file ${d}.yaml already exists. Overwrite?`,{initial:!1})){s.info("Theme creation cancelled");return}}let g=Bt("Creating theme...").start();try{await M(m);let b=await Ns(),F=Us(b,c,p,d);await _(f,F),g.succeed("\u2705 Theme created successfully!");}catch(b){throw g.fail("Failed to create theme"),b}let D=Date.now()-i;await a.track({name:"create-theme",payload:{status:"success",duration:D,metadata:{vendor:c,themeFilename:d,ci:!!n.ci}}});let h=k.relative(process.cwd(),f);if(u){s.json({status:"success",path:f,vendor:c,themeFilename:d,themeName:p});return}s.success(`
Theme created at: ${h}`),s.info(`
\u{1F4DD} To use this theme, update your params.yaml:`),s.info(`
hugoblox:`),s.info("  theme:"),s.info(`    pack: "${c}/${d}"`),n.ci||await O(`
\u{1F30D} Would you like to share this theme with the community?`,{initial:!1})&&(s.info(`
\u2728 Great! Here's how to publish your theme:`),s.info(`
1\uFE0F\u20E3  Create a new GitHub repository`),s.info("2\uFE0F\u20E3  In your repo, create a folder structure: hugoblox/themes/"),s.info(`3\uFE0F\u20E3  Copy your theme file to: hugoblox/themes/${d}.yaml`),s.info("4\uFE0F\u20E3  Commit and push to GitHub"),s.info(`
\u{1F4E2} Once published, others can install it with:
   hbx add theme --repo https://github.com/${c}/your-repo-name
`),s.info("\u{1F4A1} Tip: You can add multiple themes to the same repository!"));}catch(c){let l=X(c),d=Date.now()-i;if(await a.track({name:"create-theme",payload:{status:"error",duration:d,errorCode:l.errorCode,errorMessage:l.errorMessage,metadata:{ci:!!n.ci}}}),u){s.json({status:"error",message:c instanceof Error?c.message:String(c)});return}throw c}});}function kn(r,e){let t=r.command("create").description("Create resources (site, theme, block)");En(t,e),Sn(t,e),an(t,e);}function Bn(r){return r.quiet?"quiet":r.filter?"filtered":"verbose"}function Tn(r,e){Vs(r,e),Ws(r,e);}function Vs(r,e){r.command("dev [hugoArgs...]").description("Start the Hugo development server (hugo server)").option("--path <dir>","Project directory (defaults to cwd)").option("--no-default-flags","Disable automatic --disableFastRender flag").option("--quiet","Suppress all output except errors").option("--filter","Show only warnings and errors (hide info messages)").option("--verbose","Show all Hugo output (default)").action(async(t,n,o)=>{let i=Date.now(),{logger:s,telemetry:a}=e,c=!!o.optsWithGlobals().json,l=await Rn(n.path),d=Bn(n),p=["server"];n.defaultFlags!==false&&p.push("--disableFastRender"),p.push(...t),c||(d==="quiet"?s.info("\u{1F507} Quiet mode: showing only errors"):d==="filtered"&&s.info("\u{1F50D} Filtered mode: showing warnings and errors"));try{await $n(p,l,s,{allowSignalExit:!0,label:"dev server",outputLevel:d});let m=Date.now()-i;await a.track({name:"dev",payload:{status:"success",duration:m,metadata:{customPath:!!n.path,defaultFlags:n.defaultFlags!==!1,outputLevel:d,args:t}}});}catch(m){let f=X(m),g=Date.now()-i;throw await a.track({name:"dev",payload:{status:"error",duration:g,errorCode:f.errorCode,errorMessage:f.errorMessage,metadata:{customPath:!!n.path,defaultFlags:n.defaultFlags!==false,outputLevel:d,args:t}}}),m}c&&s.json({status:"success"});});}function Ws(r,e){r.command("build [hugoArgs...]").description("Run a production Hugo build (hugo --gc --minify)").option("--path <dir>","Project directory (defaults to cwd)").option("--no-default-flags","Disable automatic --gc/--minify flags").option("--quiet","Suppress all output except errors").option("--filter","Show only warnings and errors (hide info messages)").action(async(t,n,o)=>{let i=Date.now(),{logger:s,telemetry:a}=e,c=!!o.optsWithGlobals().json,l=await Rn(n.path),d=Bn(n),p=[];n.defaultFlags!==false&&p.push("--gc","--minify"),p.push(...t),c||(d==="quiet"?s.info("\u{1F507} Quiet mode: showing only errors"):d==="filtered"&&s.info("\u{1F50D} Filtered mode: showing warnings and errors"));try{await $n(p,l,s,{allowSignalExit:!1,label:"build",outputLevel:d});let m=Date.now()-i;await a.track({name:"build",payload:{status:"success",duration:m,metadata:{customPath:!!n.path,defaultFlags:n.defaultFlags!==!1,outputLevel:d,args:t}}});}catch(m){let f=X(m),g=Date.now()-i;throw await a.track({name:"build",payload:{status:"error",duration:g,errorCode:f.errorCode,errorMessage:f.errorMessage,metadata:{customPath:!!n.path,defaultFlags:n.defaultFlags!==false,outputLevel:d,args:t}}}),m}c&&s.json({status:"success"});});}async function Rn(r){let e=r?k.resolve(r):k.resolve(process.cwd()),t=await j(e);if(!t)throw new y("Unable to locate a HugoBlox project. Run this inside a project or pass --path.");return t.root}async function $n(r,e,t,n){let o=n.outputLevel??"verbose";t.info(`Running: hugo ${r.join(" ")}`);try{if(o==="verbose"){await execa("hugo",r,{cwd:e,stdio:"inherit"}),t.success(`Hugo ${n.label} finished`);return}let i=execa("hugo",r,{cwd:e});i.stdout?.on("data",s=>{let a=s.toString().split(`
`);for(let u of a)u.trim()&&Gs(u,o)&&process.stdout.write(`${u}
`);}),i.stderr?.on("data",s=>{let a=s.toString().split(`
`);for(let u of a)u.trim()&&process.stderr.write(`${u}
`);}),await i,t.success(`Hugo ${n.label} finished`);}catch(i){let s=i;if(n.allowSignalExit&&(s.signal==="SIGINT"||s.signal==="SIGTERM")){t.info("Hugo process stopped");return}throw new y(`Hugo ${n.label} failed: ${s.shortMessage??s.message}`,{error:s})}}function Gs(r,e){let t=r.toLowerCase();if(t.includes("web server is available")||t.includes("press ctrl+c to stop")||t.includes("error")||t.includes("fatal")||t.includes("failed"))return  true;if(e==="quiet")return  false;let o=t.includes("warn")||t.includes("deprecated")||t.includes("caution")||t.includes("\u26A0");return e==="filtered"?o:true}var pr=Pr(cr());function At(r){let e=[],t=r.split(/\r?\n/),n=false;for(let o of t){let i=o.trim();if(i.startsWith("require (")){n=true;continue}if(n&&i===")"){n=false;continue}let s="";if(!n&&i.startsWith("require ")?s=i.replace("require","").trim():n&&(s=i),s){s=s.split("//")[0].trim();let a=s.split(/\s+/);a.length>=2&&e.push({path:a[0],version:a[1]});}}return e}function _o(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ho(r,e,t,n,o){let i=r,s=u=>u.replace(/^v/,"");for(let u of e){let c=new RegExp(`(^[\\t ]*)${_o(u.from)}\\s+v(\\d+\\.\\d+\\.\\d+)(-0\\.[0-9]{14}-[a-f0-9]{12})?(\\s+//.*)?`,"gm");i=i.replace(c,(l,d,p,m,f)=>{let g=f??"",D=o?.get(u.to);if(!D)throw new Error(`Cannot migrate ${u.from} to ${u.to}: failed to resolve latest version.
Please check your internet connection or try manually updating go.mod.

Tip: If this is a new module, stable versions might not be available yet. Try running with --canary.`);let h=s(D);return `${d}${u.to} v${h}${g}`});}let a=new RegExp(`(^[\\t ]*)${_o(t)}([^\\s]+)\\s+v(\\d+\\.\\d+\\.\\d+)(-0\\.[0-9]{14}-[a-f0-9]{12})?(\\s+//.*)?`,"gm");return i=i.replace(a,(u,c,l,d,p,m)=>{let f=m??"",g=`${n}${l}`,D=o?.get(g);if(!D)throw new Error(`Cannot migrate ${t}${l} to ${g}: failed to resolve latest version.
Please check your internet connection or try manually updating go.mod.

Tip: If this is a new module, stable versions might not be available yet. Try running with --canary.`);let h=s(D);return `${c}${g} v${h}${f}`}),i=lr(i,e,t,n),i}function lr(r,e,t,n){let o=r;for(let i of e)o=o.replaceAll(i.from,i.to);return o.includes(t)&&(o=o.replaceAll(t,n)),o}async function Io(r,e){let{execa:t}=await import('execa');try{await t("go",["mod","edit","-droprequire",e],{cwd:r});}catch(n){throw new Error(`Failed to remove module ${e} from go.mod: ${String(n)}`)}}async function Ie(r,e={}){Ur();let t=k.join(r,"go.mod"),n;try{n=await H.readFile(t,"utf8");}catch{return []}let o=At(n).map(a=>({...a,path:je(a.path)})),i=e.includeThirdParty?o:o.filter(a=>De.some(u=>a.path.startsWith(u)));return await Promise.all(i.map(async a=>{let u=De.some(c=>a.path.startsWith(c));try{let[c,l]=await Promise.all([dr(a.path),u?Oo(a.path):Promise.resolve(void 0)]),d,p=a.version.match(/^v\d+\.\d+\.\d+-(\d{14})-[a-f0-9]{12}$/);if(p){let g=p[1],D=new Date(`${g.slice(0,4)}-${g.slice(4,6)}-${g.slice(6,8)}T${g.slice(8,10)}:${g.slice(10,12)}:${g.slice(12,14)}Z`);Number.isNaN(D.getTime())||(d=D.toISOString());}else {let g;if(a.path.includes("github.com/HugoBlox/kit/modules")?g="HugoBlox/kit":a.path.includes("github.com/HugoBlox/hugo-blox-builder/modules")&&(g="HugoBlox/hugo-blox-builder"),g)try{let h=(await Nt(g)).find(b=>b.name.endsWith(`/${a.version}`)||b.name===a.version||b.name===`v${a.version}`);h&&(d=await Ut(h.commit.url));}catch{}}let{updateAvailable:m}=fr(a.version,c?.version,c?.date),f=!1;return l?.date&&(d?f=new Date(l.date)>new Date(d):c?.date&&(f=!1),a.version.includes(l.version.substring(0,12))&&(f=!1)),{path:a.path,current:a.version,latest:c?.version,latestTagged:c?.version,latestDate:c?.date,canaryVersion:l?.version,canaryDate:l?.date,updateAvailable:m,canaryUpdateAvailable:f}}catch(c){return {path:a.path,current:a.version,latest:void 0,updateAvailable:false,canaryUpdateAvailable:false,error:c.message}}}))}async function dr(r){let e=je(r);if(e.includes("github.com/HugoBlox/kit/modules"))return jo(e,"HugoBlox/kit");if(e.includes("github.com/HugoBlox/hugo-blox-builder"))return jo(e,"HugoBlox/hugo-blox-builder")}async function jo(r,e){let t=await Nt(e),n=e==="HugoBlox/kit"?"github.com/HugoBlox/kit/":te,o=r.split(n);if(o.length<2)return;let i=o[1],s=t.filter(d=>d.name.startsWith(`${i}/`)&&/v\d+\.\d+\.\d+/.test(d.name));if(s.length===0)return;s.sort((d,p)=>{let m=d.name.split("/").pop()||"0.0.0",f=p.name.split("/").pop()||"0.0.0";return z.rcompare(m,f)});let a=s[0],u=a.name.split("/"),c=u[u.length-1];if(!c)return;let l=await Ut(a.commit.url);return {version:c,date:l}}async function Oo(r){let e=je(r),t="",n="";if(e.includes("github.com/HugoBlox/kit/modules")){t="HugoBlox/kit";let i=e.split("github.com/HugoBlox/kit/");i.length>=2&&(n=i[1]);}else if(e.includes("github.com/HugoBlox/hugo-blox-builder/modules")){t="HugoBlox/hugo-blox-builder";let o=te,i=e.split(o);i.length>=2&&(n=i[1]);}if(!(!t||!n))try{let o=await yt(t,n);if(o)return {version:o.sha,date:o.date}}catch{}}async function Lo(r,e){let t=je(r),n="HugoBlox/hugo-blox-builder",o="";if(t.includes("github.com/HugoBlox/kit/")){n="HugoBlox/kit";let l=t.split("github.com/HugoBlox/kit/");if(l.length<2)return;o=l[1];}else if(t.includes(te)){let l=t.split(te);if(l.length<2)return;o=l[1];}else return;let i=e==="main"||e.startsWith("v")?e:`v${e}`,s=e==="main"?"main":`${o}/${i.replace(/^v/,"v")}`,a=`${o}/hugo.yaml`,u=await ht(n,a,s);return u?gr.parse(u)?.module?.hugoVersion?.min:void 0}async function No(r,e={}){let t=k.join(r,"go.mod"),n=[k.join(r,"config","_default","module.yaml"),k.join(r,"config","_default","modules.yaml"),k.join(r,"config","_default","module.toml"),k.join(r,"config","_default","modules.toml")];try{let o=await H.readFile(t,"utf8"),i=e.fetchLatest===!0?await Ba(o,e.fetchLatestFn??dr):void 0,s=Ho(o,Ge,te,gt,i);s!==o&&await H.writeFile(t,s,"utf8");}catch(o){if(o.code==="ENOENT")return;throw o}for(let o of n)try{let i=await H.readFile(o,"utf8"),s=lr(i,Ge,te,gt);s!==i&&await H.writeFile(o,s,"utf8");}catch{}}function je(r){let e=Ge.find(t=>t.from===r);return e?e.to:r.startsWith(te)?r.replace(te,gt):r}async function Ba(r,e){let n=At(r).map(s=>{let a=je(s.path);if(a!==s.path)return a}).filter(s=>!!s),o=Array.from(new Set(n)),i=await Promise.all(o.map(async s=>{try{let a=await e(s);return a?[s,a.version]:void 0}catch{return}}));return new Map(i.filter(s=>!!s))}function fr(r,e,t){if(!r||!e)return {updateAvailable:false,diff:""};let n=r.match(/^v\d+\.\d+\.\d+-(\d{14})-[a-f0-9]{12}$/);if(n){if(t){let s=n[1],a=s.substring(0,4),u=s.substring(4,6),c=s.substring(6,8),l=s.substring(8,10),d=s.substring(10,12),p=s.substring(12,14),m=new Date(`${a}-${u}-${c}T${l}:${d}:${p}Z`),f=new Date(t);return Number.isNaN(m.getTime())||Number.isNaN(f.getTime())?{updateAvailable:false,diff:""}:f>m?{updateAvailable:true,diff:`${G(r)} -> ${G(e)} (newer stable)`}:{updateAvailable:false,diff:""}}return {updateAvailable:false,diff:""}}let o=z.coerce(r),i=z.coerce(e);return !o||!i?{updateAvailable:false,diff:""}:z.lt(o,i)?{updateAvailable:true,diff:`${G(r)} -> ${G(e)}`}:{updateAvailable:false,diff:""}}function G(r){let e=/v\d+\.\d+\.\d+-(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})-([a-f0-9]{12})/,t=r.match(e);if(t){let[n,o,i,s,a,u,c,l]=t;return `commit ${l.substring(0,7)} (released ${o}-${i}-${s})`}return r}function Ta(r,e,t="v0.0.0"){let n=new Date(e),o=n.getUTCFullYear(),i=String(n.getUTCMonth()+1).padStart(2,"0"),s=String(n.getUTCDate()).padStart(2,"0"),a=String(n.getUTCHours()).padStart(2,"0"),u=String(n.getUTCMinutes()).padStart(2,"0"),c=String(n.getUTCSeconds()).padStart(2,"0"),l=`${o}${i}${s}${a}${u}${c}`,d=r.substring(0,12);return t==="v0.0.0"?`${t}-${l}-${d}`:`${t}-0.${l}-${d}`}async function Uo(r){let[e,t]=await Promise.all([Oo(r),dr(r)]);if(!e?.date)return;let n="v0.0.0";if(t?.version){let o=z.parse(t.version);o&&(n=`v${o.major}.${o.minor}.${o.patch+1}`);}return {version:Ta(e.version,e.date,n),date:e.date}}async function Ra(){try{return (await Vr("HugoBlox/kit")).filter(e=>e.type==="tree"&&e.path.startsWith("modules/")&&e.path!=="modules").map(e=>`github.com/HugoBlox/kit/${e.path}`)}catch{return []}}async function Vo(r,e){let t=await Ra();if(t.length===0)return e?.warn("Failed to fetch latest module list, skipping cleanup."),[];let n=k.join(r,"go.mod"),o;try{o=await H.readFile(n,"utf8");}catch{return []}let i=At(o).map(c=>({...c,normalizedPath:je(c.path)})),s=Ge,a=new Set(s.map(c=>c.from)),u=[];for(let c of i){let l=c.normalizedPath;De.some(d=>l.startsWith(d))&&(t.includes(l)||a.has(l)||u.push(c.path));}if(u.length>0){e?.info(`Cleaning up obsolete modules: ${u.join(", ")}`);for(let c of u)await Io(r,c),await _a(r,c);try{await H.rm(k.join(r,"go.sum"),{force:!0});let{execa:c}=await import('execa');await c("hugo",["mod","tidy"],{cwd:r});}catch{e?.warn("'hugo mod tidy' failed after cleanup. You may still have lingering imports in your config.");}e?.info("Tip: If you see module path errors, check your hugo.toml/module.yaml for manual removal.");}return u}function $a(r){if(r.endsWith(".toml"))return "toml";if(r.endsWith(".yaml")||r.endsWith(".yml"))return "yaml";if(r.endsWith(".json"))return "json"}function Ma(r,e,t){let n=r.split(`
`),o=new Set;if(t==="toml"){let i=-1,s=false;for(let a=0;a<n.length;a++){let c=n[a].trim();if(c.startsWith("[[")?(i=a,s=c==="[[module.imports]]"):c.startsWith("[")&&(i=a,s=false),s&&i!==-1&&c.match(new RegExp(`^path\\s*=\\s*["']${e}["']`)))for(let l=i;l<n.length;l++){let d=n[l].trim();if(l>i&&d.startsWith("["))break;o.add(l);}}}else if(t==="yaml")for(let i=0;i<n.length;i++){let a=n[i].match(new RegExp(`^(\\s*)(-?\\s*)path:\\s*["']?${e}["']?`));if(a){let u=a[1].length;o.add(i);for(let c=i+1;c<n.length;c++){let l=n[c],d=l.trim();if(!d)continue;let p=l.match(/^(\s*)/),m=p?p[1].length:0;if(m<u||m===u&&d.startsWith("-"))break;o.add(c);}}}return n.filter((i,s)=>!o.has(s)).join(`
`)}async function _a(r,e){let t=["hugo.toml","config.toml","module.yaml","module.toml","config.yaml","config/_default/module.yaml","config/_default/module.toml","config/_default/config.toml","config/_default/config.yaml"];for(let n of t){let o=k.join(r,n);try{let i=await H.readFile(o,"utf8"),s=$a(n);if(s==="toml"||s==="yaml"){let a=Ma(i,e,s);a!==i&&await H.writeFile(o,a,"utf8");}}catch{}}}function Go(r){let e=process.env.HOME||process.env.USERPROFILE;if(!e)return r;let t=k.resolve(e),n=k.resolve(r);return n.startsWith(t)?n.replace(t,"~"):r}var Ia={win32:{node:"winget install OpenJS.NodeJS.LTS",git:"winget install Git.Git",go:"winget install GoLang.Go",hugo:"winget install Hugo.Hugo.Extended"},darwin:{node:"brew install node",git:"brew install git",go:"brew install golang",hugo:"brew install hugo"},linux:{node:"sudo snap install node --classic",git:"sudo apt install git || sudo yum install git",go:"sudo snap install go --classic",hugo:"sudo snap install hugo --classic"}};function tt(r){let e=process.platform==="win32"?"win32":process.platform==="darwin"?"darwin":"linux";return Ia[e][r]}async function Pt(r,e){try{let t=await execa(r,e,{reject:!1});return t.exitCode===0?t.stdout.trim():`Failed (${t.stderr.trim()})`}catch(t){return `Not available (${t.message})`}}function zo(r,e){r.command("doctor").description("Check local environment for common issues").action(async(t,n)=>{let{logger:o,config:i}=e,a=!!n.optsWithGlobals().json,u=[],c=process.version,l=z.gte(c,"18.0.0");u.push({name:"Node.js",ok:l,details:l?c:`${c} (Required: 18+)`,level:l?"info":"error",fix:l?void 0:tt("node")});let d=await Pt("git",["--version"]),p=!d.startsWith("Not")&&!d.startsWith("Failed");u.push({name:"Git",ok:p,details:d,level:p?"info":"error",fix:p?void 0:tt("git")});let m=await Pt("go",["version"]),f=!m.startsWith("Not")&&!m.startsWith("Failed");u.push({name:"Go",ok:f,details:f?m:"Not installed",level:f?"info":"error",fix:f?void 0:tt("go")});let g=await Pt("hugo",["version"]),D=!g.startsWith("Not")&&!g.startsWith("Failed"),h=D&&g.toLowerCase().includes("extended"),b;D?h?b={name:"Hugo",ok:true,details:g,level:"info"}:b={name:"Hugo",ok:false,details:`${g} (Extended version required)`,level:"error",fix:tt("hugo")}:b={name:"Hugo",ok:false,details:"Not installed",level:"error",fix:tt("hugo")},u.push(b);let F=ja(g),S=await Pt("pnpm",["--version"]);u.push({name:"pnpm",ok:!S.startsWith("Not"),details:S});let T=i.getLicense();u.push({name:"Pro license",ok:!!T,details:T?"Configured":"Missing"});let B=await j();if(B){let R=await Wr(B.root);if(R){let V=R.templateName??R.templateId??"Unknown";u.push({name:"Template",ok:true,details:`${V} (${Go(B.root)})`});let We=Oa(R.requiredHugoVersion,F);We&&u.push(We);}let Fi=await Ie(B.root);for(let V of Fi){let We=V.path.split("/").pop()||V.path,It=V.current;if(V.latest){let Fr=z.coerce(V.current),Sr=z.coerce(V.latest);Fr&&Sr&&z.eq(Fr,Sr)&&(It=`${It} (latest)`);}u.push({name:`Module: ${We}`,ok:true,details:It});let{updateAvailable:Si}=fr(V.current,V.latest);Si&&V.latest&&u.push({name:`${We} update`,ok:false,details:`Current ${V.current}, latest ${V.latest}. Run 'hbx upgrade' to update.`,level:"warn"});}}let Q=u.some(R=>(R.level??(R.ok?"info":"error"))==="error"),A=u.some(R=>(R.level??(R.ok?"info":"error"))==="warn"),w={status:Q?"error":"success",checks:u};if(a){o.json(w);return}let x=u.filter(R=>["Node.js","Git","Go","Hugo","pnpm"].includes(R.name)),N=u.filter(R=>["Template","Hugo version compatibility","Pro license"].includes(R.name)),ue=u.filter(R=>R.name.startsWith("Module:")||R.name.includes("update"));o.info(`
\u{1F50D} Environment`),mr(x),N.length>0&&(o.info(`
\u{1F4E6} Project`),mr(N)),ue.length>0&&(o.info(`
\u{1F9E9} HugoBlox Modules`),mr(ue)),La(u,Q,A,o);});}function ja(r){let e=r.match(/v(\d+\.\d+\.\d+)/i);return e?e[1]:r.match(/(\d+\.\d+\.\d+)/)?.[1]}function Oa(r,e){if(!r||!e)return;let t=z.coerce(r),n=z.coerce(e);if(!(!t||!n))return z.lt(n,t)?{name:"Hugo version compatibility",ok:false,details:`Template requires Hugo ${t.version}, but ${n.version} is installed`,level:"error"}:z.major(n)>z.major(t)||z.minor(n)>z.minor(t)?{name:"Hugo version compatibility",ok:true,details:`Using Hugo ${n.version}; template tested with ${t.version}`,level:"warn"}:{name:"Hugo version compatibility",ok:true,details:`Template requires Hugo ${t.version} and you're running ${n.version}`,level:"info"}}function mr(r){if(r.length===0)return;let e=new pr.default({head:["Check","Status","Details/Fix"],colWidths:[20,12,90],style:{head:["cyan","bold"],border:["gray"]},wordWrap:true});for(let t of r){let n=t.level??(t.ok?"info":"error"),o="",i;n==="error"?(o="\u2717 FAIL",i="\x1B[31m"):n==="warn"?(o="\u26A0 WARN",i="\x1B[33m"):(o="\u2713 PASS",i="\x1B[32m");let a=`${i}${o}\x1B[0m`,u=t.name.replace("Module: ","").replace(" update"," (update)"),c=t.details;t.fix&&(c+=`
\x1B[33mFix: ${t.fix}\x1B[0m`),e.push([u,a,c]);}console.log(e.toString());}function La(r,e,t,n){let o=r.filter(c=>(c.level??(c.ok?"info":"error"))==="info").length,i=r.filter(c=>(c.level??(c.ok?"info":"error"))==="warn").length,s=r.filter(c=>(c.level??(c.ok?"info":"error"))==="error").length;n.info(`
\u{1F4CA} Summary`);let a=new pr.default({head:["Status","Count"],colWidths:[20,10],style:{head:["cyan","bold"],border:["gray"]}});a.push(["\x1B[32m\u2713 Passed\x1B[0m",o.toString()],["\x1B[33m\u26A0 Warnings\x1B[0m",i.toString()],["\x1B[31m\u2717 Failed\x1B[0m",s.toString()]),console.log(a.toString()),e?n.error(`
\u274C Some checks failed. Please run the suggested fix commands above.`):t?n.warn(`
\u26A0\uFE0F  All critical checks passed, but there are warnings to review.`):n.success(`
\u2705 All checks passed! Your environment is ready.`),r.filter(c=>c.name.includes("update")).length>0&&n.info(`
\u{1F4A1} Tip: Run 'hbx upgrade --yes' to update modules to the latest versions.`);}function qo(r,e){r.command("install").description("Hydrate HugoBlox Pro assets").option("--ci","Fail when prompts would appear").option("--force","Force re-download of assets").option("--path <dir>","Project directory (defaults to cwd)").action(async(t,n)=>{let o=Date.now(),{logger:i,config:s,telemetry:a}=e,c=!!n.optsWithGlobals().json;try{let l=t.path?{root:k.resolve(t.path),manifestPath:k.join(k.resolve(t.path),"hbx.blocks.json")}:await j();if(!l)throw new y("Unable to locate a HugoBlox project - pass --path if needed");let d=s.getLicense();if(!d){if(t.ci)throw new y(`Missing license key. Set ${ke} or run hbx login before using --ci.`);i.warn("No Pro license detected, proceeding with OSS assets only");}let p=Bt("Hydrating Pro assets...").start();try{let g=k.join(l.root,"config","_default","module.hbx.toml"),D=k.join(l.root,"node_modules","@hugoblox-pro","sample");await M(D),await _(k.join(D,"README.md"),`# HugoBlox Pro assets placeholder
`),await _(g,`# Generated by hbx install
[[module.imports]]
path = "github.com/HugoBlox/hugo-blox-builder"
[[module.imports]]
path = "node_modules/@hugoblox-pro/sample"
`),p.succeed("Assets hydrated");}catch(g){throw p.fail("Failed to hydrate assets"),g}let m=Date.now()-o;await a.track({name:"install",payload:{status:"success",duration:m,metadata:{ci:!!t.ci,force:!!t.force,tokenPresent:!!d,customPath:!!t.path}}});let f={status:"success",path:l.root,forced:!!t.force,token:!!d};c?i.json(f):(i.success("Install complete"),d||i.info("Tip: run hbx login to unlock Pro downloads"));}catch(l){let d=X(l),p=Date.now()-o;throw await a.track({name:"install",payload:{status:"error",duration:p,errorCode:d.errorCode,errorMessage:d.errorMessage,metadata:{ci:!!t.ci,force:!!t.force,customPath:!!t.path}}}),l}});}function Xo(r,e){r.command("login").description("Authenticate with HugoBlox Pro and register this device for template access").option("--token <value>","License key").option("--ci","Fail when license key is missing").action(async(t,n)=>{let{config:o,logger:i}=e,a=!!n.optsWithGlobals().json,u=t.token;if(!u){if(t.ci)throw new y("License key is required when using --ci");u=await q("Enter your HugoBlox Pro license key");}let c=false;try{o.setLicense(u),await o.save(),c=!0,await Y(e,{force:!0});let l={status:"success",token:Jt(u)};a?i.json(l):i.success(`License key saved (${Jt(u)})`);}catch(l){throw c&&(o.clearLicense(),await o.save()),Ua(l)}});}function Yo(r,e){r.command("logout").description("Remove stored HugoBlox credentials and device secrets").action(async(t,n)=>{let{config:o,logger:i}=e,s=!!n.optsWithGlobals().json;await dn(o),o.clearLicense(),await o.save();let a={status:"success"};s?i.json(a):i.success("License key removed");});}function Ua(r){let e=r instanceof Error?r.message:"Device registration failed",t="HBX must register this machine before downloading Pro templates. Check your internet connection, ensure your license has a free device slot, or revoke an old device and rerun 'hbx login'.";return r instanceof ee?new y(`${e}. ${t}`,r.details):new y(`${e}. ${t}`)}function rt(r){let e=r.match(/^---\r?\n([\s\S]*?)\r?\n---\r?\n([\s\S]*)$/);if(!e)return {frontMatter:{},body:r};try{let t=gr.parse(e[1]);return typeof t!="object"||t===null||Array.isArray(t)?{frontMatter:{},body:r}:{frontMatter:t,body:e[2]??""}}catch{return {frontMatter:{},body:r}}}async function*Le(r){let e;try{e=await H.readdir(r,{withFileTypes:!0});}catch{return}for(let t of e){let n=k.join(r,t.name);if(t.isDirectory()){try{if((await H.lstat(n)).isSymbolicLink())continue}catch{continue}yield*Le(n);}else t.name.endsWith(".md")&&(yield n);}}function Qo(r,e){r.command("v0.11.0-authors").description("Migrate author profiles from content/authors/ to data/authors/ (v0.11.0+)").option("-y, --yes","Skip confirmation prompts").option("--dry-run","Preview changes without modifying files").action(async t=>{await hr(e,t);});}async function hr(r,e={}){let{logger:t}=r,n=e.projectRoot??(await j())?.root;if(!n)throw new y("No Hugo project found in the current directory.");let o=Bt("Analyzing author profiles...").start();try{let i=k.join(n,"content","authors"),s=k.join(n,"data","authors"),a=await za(s);if(!await C(i)){o.stop(),a?t.info("\u2139\uFE0F  data/authors/ already exists. Skipping author migration."):t.info("\u2139\uFE0F  No authors directory found. Nothing to migrate.");return}if(a){if(o.stop(),e.skipIfDataExists){t.info("\u2139\uFE0F  data/authors/ already contains author data. Skipping author migration.");return}throw new y(`data/authors/ already contains author data.
Please remove or back it up before running this migration.`)}let u=await Zo(i);if(u.length===0){o.stop(),t.info("\u2139\uFE0F  No author profiles found to migrate.");return}o.stop(),t.info(`
\u{1F4CB} Migration Plan (v0.11.0 Author System):
`),t.info(`   Found ${u.length} author profile(s):`);for(let d of u){let p=d.slug==="admin"?"me":d.slug;t.info(`     \u2022 ${d.slug} \u2192 data/authors/${p}.yaml`),d.avatarPath&&t.info(`       Avatar: ${k.basename(d.avatarPath)} \u2192 assets/media/authors/${p}${k.extname(d.avatarPath)}`);}if(t.info(`
   Changes:`),t.info("     \u2713 Create data/authors/ directory"),t.info("     \u2713 Generate YAML files with new schema (hugoblox/author/v1)"),t.info("     \u2713 Migrate avatar images to assets/media/authors/"),t.info("     \u2713 Update author references in content files"),t.info("     \u2713 Archive original content/authors/ directory"),e.dryRun){t.info(`
\u{1F50D} Dry run mode - no files will be modified.`);return}if(!e.yes&&!await O(`
This will restructure your author data. We recommend backing up first. Continue?`,{initial:!1})){t.info("Migration cancelled.");return}let c=t.isJsonMode?.()??!1,l=await au(n,u,t,c);if(t.info(""),l.success)t.success("\u2705 Migration complete!"),t.info(`   \u2022 Migrated ${l.authorsMigrated} author profile(s)`),t.info(`   \u2022 Updated ${l.contentFilesMigrated} content file(s)`),t.info(`
\u{1F4DA} Next steps:`),t.info("   1. Review generated files in data/authors/"),t.info("   2. Test your site: pnpm dev"),t.info("   3. Remove backup: rm -rf content/authors.backup");else {t.error("\u274C Migration completed with errors:");for(let d of l.errors)t.error(`   \u2022 ${d}`);if(t.info(`
   Original files preserved in content/authors/`),e.strict)throw new y("Author migration completed with errors. Please review the log and retry.")}}catch(i){throw o.stop(),i}}async function za(r){if(!await C(r))return  false;try{return (await H.readdir(r)).some(t=>t.endsWith(".yaml")||t.endsWith(".yml"))}catch{return  false}}async function Zo(r){let e=[],t=await H.readdir(r,{withFileTypes:true});for(let n of t){if(!n.isDirectory()||n.name.startsWith("_"))continue;let o=k.join(r,n.name),i=k.join(o,"_index.md");if(!await C(i)){let a=k.join(o,"index.md");if(await C(a))i=a;else continue}let s=ei(n.name);if(s)try{let a=await H.readFile(i,"utf8"),{frontMatter:u,body:c}=rt(a),l,p=(await H.readdir(o)).find(m=>/^avatar\.(png|jpg|jpeg|webp)$/i.test(m));p&&(l=k.join(o,p)),e.push({slug:n.name,targetSlug:s,originalPath:o,frontMatter:u,content:c.trim(),avatarPath:l});}catch{}}return e}function ei(r){let e=ne(r);if(e)return e==="admin"?"me":e}function v(r){if(typeof r!="string")return;let e=r.trim();return e===""?void 0:e}function nt(r){return typeof r=="number"&&Number.isFinite(r)?r:v(r)}function qa(r){return Array.isArray(r)?r.map(e=>v(e)).filter(e=>!!e):[]}function Xa(r){let e={},t=v(r.title??r.name);t&&(e.display=t);let n=v(r.first_name??r.given_name??r.given);n&&(e.given=n);let o=v(r.last_name??r.family_name??r.family);o&&(e.family=o);let i=v(r.middle_name??r.middle);i&&(e.middle=i);let s=v(r.nickname??r.alternate_name??r.alt_name);s&&(e.alternate=s);let a=v(r.name_pronunciation??r.pronunciation);a&&(e.pronunciation=a);let u=v(r.pronouns);return u&&(e.pronouns=u),e}function Ya(r){if(r.status&&typeof r.status=="object"&&!Array.isArray(r.status)){let t=v(r.status.icon);if(t)return {icon:t}}let e=v(r.status_icon??r.status_emoji??r.status);if(e)return {icon:e}}function Ka(r){return Array.isArray(r)?r.map(e=>{if(typeof e!="object"||e===null)return;let t=e,n=v(t.name);if(!n)return;let o=v(t.url);return o?{name:n,url:o}:{name:n}}).filter(e=>!!e):[]}function Ja(r){let e={},t=["orcid","google_scholar","openalex","semantic_scholar","research_gate","scopus","arxiv"];for(let i of t){let s=v(r[i]);s&&(e[i]=s);}let n=[];Array.isArray(r.profiles)&&n.push(...r.profiles);let o=r.links;Array.isArray(o)&&n.push(...o);for(let i of n){if(typeof i!="object"||i===null)continue;let s=v(i.url);s&&Qa(s,e);}return Object.keys(e).length===0?void 0:e}function Qa(r,e){if(/^https?:\/\//i.test(r))try{let t=new URL(r),n=t.hostname.toLowerCase(),o=t.pathname.split("/").filter(Boolean);if(n.includes("scholar.google.")){let i=t.searchParams.get("user");i&&!e.google_scholar&&(e.google_scholar=i);return}if(n.includes("orcid.org")){let i=t.pathname.match(/(\d{4}-\d{4}-\d{4}-\d{3}[0-9X])/i);i&&!e.orcid&&(e.orcid=i[1]);return}if(n.includes("openalex.org")){let i=o[o.length-1];i&&!e.openalex&&(e.openalex=i);return}if(n.includes("semanticscholar.org")){let i=o[o.length-1];i&&!e.semantic_scholar&&(e.semantic_scholar=i);return}if(n.includes("researchgate.net")){let i=o[o.length-1];i&&!e.research_gate&&(e.research_gate=i);return}if(n.includes("scopus.com")){let i=t.searchParams.get("authorId")??t.searchParams.get("scopusId")??o[o.length-1];i&&!e.scopus&&(e.scopus=i);return}if(n.includes("arxiv.org")){let i=o[o.length-1];i&&!e.arxiv&&(e.arxiv=i);}}catch{}}function Za(r,e,t){let n=[];if(Array.isArray(r))for(let s of r){if(typeof s!="object"||s===null)continue;let a=s,u=v(a.icon),c=v(a.url),l=v(a.label);if(u&&c){let d={icon:u,url:c};l&&(d.label=l),n.push(d);}}let o=v(t);if(o){let s=o.startsWith("mailto:")?o:`mailto:${o}`;n.some(a=>a.url===s)||n.push({icon:"at-symbol",url:s,label:"Email"});}let i=v(e);return i&&!n.some(s=>s.url===i)&&n.push({icon:"link",url:i,label:"Website"}),n}function eu(r){if(typeof r=="string"){let e=r.trim();return e||void 0}if(Array.isArray(r)){let e=r.map(t=>v(t)).filter(t=>!!t);if(e.length>0)return e}}function tu(r){return Array.isArray(r)?r.map(e=>{if(typeof e!="object"||e===null)return;let t=e,n=v(t.institution??t.organization??t.school);if(!n)return;let o={institution:n},i=v(t.degree??t.area??t.qualification);i&&(o.degree=i);let s=nt(t.year);s!==void 0&&(o.year=s);let a=nt(t.start??t.date_start);a!==void 0&&(o.start=a);let u=nt(t.end??t.date_end);u!==void 0&&(o.end=u);let c=v(t.summary);c&&(o.summary=c);let l=ti(t.button);return l&&(o.button=l),o}).filter(e=>!!e):[]}function ru(r){return Array.isArray(r)?r.map(e=>{if(typeof e!="object"||e===null)return;let t=e,n=v(t.role??t.position),o=v(t.org??t.company_name??t.company);if(!n||!o)return;let i={role:n,org:o},s=nt(t.start??t.date_start);s!==void 0&&(i.start=s);let a=nt(t.end??t.date_end);a!==void 0&&(i.end=a);let u=v(t.summary);u&&(i.summary=u);let c=ti(t.button);return c&&(i.button=c),i}).filter(e=>!!e):[]}function ti(r){if(typeof r!="object"||r===null)return;let e=r,t=v(e.url);if(!t)return;let n={url:t},o=v(e.text);o&&(n.text=o);let i=v(e.icon);return i&&(n.icon=i),n}function nu(r){return Array.isArray(r)?r.map(e=>{if(typeof e!="object"||e===null)return;let t=e,o=(Array.isArray(t.items)?t.items:[]).map(a=>{if(typeof a!="object"||a===null)return;let u=a,c=v(u.label??u.name);if(!c)return;let l={label:c},d=ri(u.level)??Dr(typeof u.percent=="number"?u.percent:void 0);d!==void 0&&(l.level=d);let p=v(u.icon);return p&&(l.icon=p),l}).filter(a=>!!a);if(o.length===0)return;let i={items:o},s=v(t.name);return s&&(i.name=s),i}).filter(e=>!!e):[]}function Dr(r){if(typeof r!="number"||Number.isNaN(r)||r<=0)return;let e=Math.min(100,r);return Math.max(1,Math.min(5,Math.ceil(e/20)))}function ri(r){if(!(typeof r!="number"||Number.isNaN(r)))return r>=1&&r<=5?Math.round(r):Dr(r)}function ou(r){return Array.isArray(r)?r.map(e=>{if(typeof e=="string"){let u=v(e);return u?{name:u}:void 0}if(typeof e!="object"||e===null)return;let t=e,n=v(t.name??t.label);if(!n)return;let o=typeof t.percent=="number"?Math.max(0,Math.min(100,t.percent)):void 0,i=ri(t.level)??Dr(o),s={name:n};i!==void 0&&(s.level=i),o!==void 0&&(s.percent=o);let a=v(t.label)??iu(o,i);return a&&(s.label=a),s}).filter(e=>!!e):[]}function iu(r,e){let t=r??(typeof e=="number"?e*20:void 0);if(t!==void 0){if(t>=99)return "Native";if(t>=90)return "C2";if(t>=75)return "C1";if(t>=60)return "B2";if(t>=45)return "B1";if(t>=30)return "A2"}}function su(r){return Array.isArray(r)?r.map(e=>{if(typeof e=="string"){let c=v(e);return c?{title:c}:void 0}if(typeof e!="object"||e===null)return;let t=e,n=v(t.title);if(!n)return;let o={title:n},i=v(t.awarder);i&&(o.awarder=i);let s=v(t.date);s&&(o.date=s);let a=v(t.summary);a&&(o.summary=a);let u=v(t.icon);return u&&(o.icon=u),o}).filter(e=>!!e):[]}function ni(r,e){let{frontMatter:t,content:n}=r,o={schema:"hugoblox/author/v1",slug:e},i=Xa(t);Object.keys(i).length>0&&(o.name=i),t.superuser===true&&(o.is_owner=true);let s=Ya(t);s&&(o.status=s);let a=v(t.role);a&&(o.role=a);let u=v(t.bio)??n.trim();u&&(o.bio=u);let c=Ka(t.organizations??t.affiliations);c.length>0&&(o.affiliations=c);let l=Ja(t);l&&(o.ids=l);let d=[];Array.isArray(t.profiles)&&d.push(...t.profiles);let p=t.links;Array.isArray(p)&&d.push(...p);let m=Za(d,t.website,t.email);m.length>0&&(o.links=m);let f=qa(t.interests);f.length>0&&(o.interests=f);let g=eu(t.postnominals??t.credentials);g&&(o.postnominals=g);let D=tu(t.education);D.length>0&&(o.education=D);let h=ru(t.work??t.experience);h.length>0&&(o.experience=h);let b=nu(t.skills);b.length>0&&(o.skills=b);let F=ou(t.languages);F.length>0&&(o.languages=F);let S=su(t.awards);return S.length>0&&(o.awards=S),typeof t.weight=="number"&&Number.isFinite(t.weight)&&(o.weight=Math.trunc(t.weight)),o}async function oi(r,e,t){let n=k.extname(r)||".png",o=k.join(e,`${t}${n}`);return await H.copyFile(r,o),o}async function yr(r,e){let t=0;for await(let n of Le(r))try{let o=await H.readFile(n,"utf8"),{frontMatter:i,body:s}=rt(o);if(!Array.isArray(i.authors))continue;let a=!1,u=i.authors.map(l=>{if(typeof l=="string"){let d=l.trim(),p=d.toLowerCase(),m=e.get(d)??e.get(l)??e.get(p);if(m)return a=!0,m}return l});if(!a)continue;i.authors=u;let c=`---
${gr.stringify(i)}---

${s}`;await H.writeFile(n,c,"utf8"),t++;}catch{}return t}function ii(r){let e=new Map,t=new Set,n=[],o=[];for(let i of r){let s=i.targetSlug??ei(i.slug);if(!s){o.push(i.slug);continue}t.has(s)&&n.push(s),t.add(s);let a=new Set([i.slug]),u=i.slug.toLowerCase();u!==i.slug&&a.add(u);let c=ne(i.slug);c&&c!==i.slug&&a.add(c);for(let l of a)e.has(l)||e.set(l,s);}if(o.length>0)throw new y(`Unable to normalize the following author slug(s): ${o.join(", ")}
Please rename them to use lowercase letters, numbers, or hyphens.`);if(n.length>0)throw new y(`Slug collision detected: Multiple profiles would map to: ${n.join(", ")}
Please manually rename one of the conflicting profiles before migration.`);return e}async function si(r,e){if(await C(e)){let t=new Date().toISOString().replace(/[:.]/g,"-").split(".")[0],n=`${e}.${t}`;return await H.cp(r,n,{recursive:true}),{backupPath:n,isTimestamped:true}}return await H.cp(r,e,{recursive:true}),{backupPath:e,isTimestamped:false}}async function ai(r,e){if(await C(r)){let n=(await H.readdir(r)).filter(o=>o.endsWith(".yaml")||o.endsWith(".yml"));if(n.length>0)throw new y(`data/authors/ already contains ${n.length} YAML file(s).
Please remove or back them up manually before running migration.`)}await M(r),await M(e);}async function ui(r,e,t,n){let o=ni(r,e),i=k.join(t,`${e}.yaml`),s=gr.stringify(o,{defaultStringType:"QUOTE_DOUBLE",lineWidth:0}),a=gr.parse(s);if(!a.schema||!a.slug)throw new Error("Generated YAML missing required fields");await H.writeFile(i,s,"utf8");let u;if(r.avatarPath)try{await oi(r.avatarPath,n,e);}catch(c){u=`Avatar copy failed: ${String(c)}`;}return {success:true,avatarError:u}}async function ci(r,e){try{e.warn("\u26A0\uFE0F  Attempting to rollback changes..."),!await C(r.authorsDir)&&await C(r.backupDir)&&(await H.cp(r.backupDir,r.authorsDir,{recursive:!0}),e.info("   \u2713 Original authors directory restored from backup"));let t=k.join(r.projectRoot,"data","authors");await C(t)&&(await H.readdir(t)).filter(s=>s.endsWith(".yaml")).length===r.authorsMigrated&&(await H.rm(t,{recursive:!0,force:!0}),e.info("   \u2713 Partial data/authors/ files removed"));let n=k.join(r.projectRoot,"assets","media","authors");return await C(n)&&(await H.readdir(n)).length<=r.authorsMigrated&&(await H.rm(n,{recursive:!0,force:!0}),e.info("   \u2713 Partial avatar files removed")),e.info("\u2713 Rollback complete. Your original files are safe."),!0}catch{return e.error("\u274C Rollback failed. Please manually check:"),e.error("   - content/authors.backup/ contains your original files"),e.error("   - You may need to manually restore them"),false}}async function au(r,e,t,n=false){let o={success:true,authorsMigrated:0,contentFilesMigrated:0,errors:[]};return n?uu(r,e,t,o):cu(r,e,t,o)}async function uu(r,e,t,n){let o=Bt("Creating backup...").start(),i=k.join(r,"content","authors"),s=k.join(r,"content","authors.backup"),a=k.join(r,"data","authors"),u=k.join(r,"assets","media","authors");try{let c=ii(e),l=await si(i,s);l.isTimestamped&&t.info(`   Previous backup preserved as: ${k.basename(l.backupPath)}`),o.text="Backup created, preparing directories...",await ai(a,u),o.text="Migrating author profiles...";for(let p=0;p<e.length;p++){let m=e[p];o.text=`Migrating profiles... (${p+1}/${e.length})`;try{let f=c.get(m.slug);if(!f)throw new y(`Unable to determine target slug for '${m.slug}'`);let g=await ui(m,f,a,u);n.authorsMigrated++,g.avatarError&&n.errors.push(`\u2713 Profile '${m.slug}' migrated, but ${g.avatarError}`);}catch(f){n.errors.push(`Failed to migrate ${m.slug}: ${String(f)}`),n.success=!1;}}o.text="Updating content references...";let d=k.join(r,"content");await C(d)&&(n.contentFilesMigrated=await yr(d,c)),o.text="Finalizing migration...",await H.rm(i,{recursive:!0,force:!0}),o.succeed("Migration complete");}catch(c){o.fail("Migration failed"),n.success=false,n.errors.push(String(c)),await ci({projectRoot:r,authorsDir:i,backupDir:s,authorsMigrated:n.authorsMigrated},t)||n.errors.push("Rollback failed");}return n}async function cu(r,e,t,n){let o=k.join(r,"content","authors"),i=k.join(r,"content","authors.backup"),s=k.join(r,"data","authors"),a=k.join(r,"assets","media","authors"),u=ii(e),c=new Listr([{title:"Creating backup of content/authors/",task:async()=>{let l=await si(o,i);l.isTimestamped&&t.info(`   Previous backup preserved as: ${k.basename(l.backupPath)}`);}},{title:"Preparing directories",task:async()=>{await ai(s,a);}},{title:"Migrating author profiles",task:(l,d)=>d.newListr(e.map(p=>{let m=u.get(p.slug)||p.targetSlug;return {title:`${p.slug} \u2192 ${m}.yaml`,task:async()=>{if(!m)throw new y(`Unable to determine target slug for '${p.slug}'`);let f=await ui(p,m,s,a);n.authorsMigrated++,f.avatarError&&n.errors.push(`\u2713 Profile '${p.slug}' migrated, but ${f.avatarError}`);}}}),{concurrent:false,rendererOptions:{collapseSubtasks:false}})},{title:"Updating content references",task:async(l,d)=>{let p=k.join(r,"content");if(!await C(p)){d.skip("No content directory found");return}n.contentFilesMigrated=await yr(p,u);}},{title:"Archive original content/authors/ directory",task:async()=>{await H.rm(o,{recursive:true,force:true});}}],{rendererOptions:{collapseSubtasks:false}});try{await c.run(),n.success=!0;}catch(l){n.success=false,n.errors.push(String(l)),await ci({projectRoot:r,authorsDir:o,backupDir:i,authorsMigrated:n.authorsMigrated},t)||n.errors.push("Rollback failed");}return n}function li(r,e){r.command("v0.11.0-events").description("Migrate legacy events content to HugoBlox v0.11.0 conventions").option("-y, --yes","Skip confirmation prompts").option("--dry-run","Preview changes without modifying files").action(async t=>{await wr(e,t);});}async function wr(r,e={}){let{logger:t}=r,n=e.projectRoot??(await j())?.root;if(!n)throw new y("No Hugo project found in the current directory.");let o=Bt("Analyzing event content...").start();try{let i=k.join(n,"content","event"),s=k.join(n,"content","events"),a=await C(i),u=await C(s),c;if(u?c=s:a&&(c=i),!c){o.stop(),t.info("\u2139\uFE0F  No legacy event content found under content/event/ or content/events/.");return}let l=await gu(c),d=a&&!u;if(o.stop(),t.info(`
\u{1F4CB} Migration Plan (v0.11.0 Events):
`),d?t.info("   \u2713 Rename content/event/ \u2192 content/events/"):a&&u?t.info("   \u2713 content/events/ already exists (no rename needed)"):a?t.info("   \u2713 Legacy content/event/ directory detected (will be renamed)."):t.info("   \u2713 No legacy directory rename required"),t.info(`   \u2713 Update front matter for ${l} event file(s)`),l===0&&!d){t.info(`
\u2139\uFE0F  No event markdown files were found to migrate.`);return}if(e.dryRun){t.info(`
\u{1F50D} Dry run mode - no files will be modified.`);return}if(!e.yes&&!await O(`
This will rename event directories (if needed) and adjust front matter. Continue?`,{initial:!1})){t.info("Migration cancelled.");return}let p=Bt("Creating backup...").start(),m=`${s}.backup`;if(await du(c,m),p.succeed(`Backup created at ${k.relative(n,m)}`),d){let D=Bt("Renaming content/event/ to content/events/...").start();try{await H.rename(i,s),D.succeed("Renamed legacy event directory.");}catch(h){throw D.fail("Failed to rename directory."),h}}let f=await C(s)?s:c;if(!f)throw new y("No event directory found to migrate after analysis.");let g=Bt("Updating event front matter...").start();try{let D=await mu(f);if(g.stop(),t.info(""),D.errors.length>0){t.error("\u274C Front matter migration completed with errors:");for(let h of D.errors)t.error(`   \u2022 ${k.relative(n,h.file)}: ${h.message}`);if(e.strict)throw new y("Event front matter migration encountered errors. Please resolve them and rerun the command.");return}t.success("\u2705 Event migration complete!"),t.info(`   \u2022 Processed ${D.processed} file(s)`),t.info(`   \u2022 Updated ${D.updated} file(s)`),t.info("   \u2022 Backup saved at content/events.backup (safe to delete if verified)");}catch(D){throw g.fail("Migration failed during file updates."),D}}catch(i){o.stop();let s=k.join(n,"content","events"),a=`${s}.backup`;throw r.logger.error(`
\u274C Event migration failed: ${String(i)}`),r.logger.warn("\u26A0\uFE0F  Attempting to rollback changes..."),await fu(s,a)?r.logger.info("\u2705 Rollback successful. Your original files have been restored."):r.logger.error("\u274C Rollback failed. Please manually check content/events.backup and restore your files."),i instanceof y?i:new y(`Event migration failed: ${String(i)}`)}}async function du(r,e){if(await C(e)){let t=new Date().toISOString().replace(/[:.]/g,"-").split(".")[0];await H.cp(r,`${e}.${t}`,{recursive:true});}else await H.cp(r,e,{recursive:true});}async function fu(r,e){try{return await C(e)?(await C(r)&&await H.rm(r,{recursive:!0,force:!0}),await H.cp(e,r,{recursive:!0}),!0):!1}catch{return  false}}async function mu(r){let e={processed:0,updated:0,errors:[]};for await(let t of Le(r))try{let n=await H.readFile(t,"utf8"),{frontMatter:o,body:i}=rt(n),{migrated:s,changed:a}=pu(o);if(!a){e.processed+=1;continue}let c=`---
${gr.stringify(s,{lineWidth:0})}---

${i}`;await H.writeFile(t,c,"utf8"),e.processed+=1,e.updated+=1;}catch(n){e.errors.push({file:t,message:String(n)}),e.processed+=1;}return e}function pu(r){let e={...r},t=false,n=(i,s)=>{e[i]===void 0&&r[s]!==void 0&&(e[i]=r[s],t=true);};n("event_start","date"),n("event_end","date_end"),n("event_all_day","all_day"),n("event_name","event"),r.publishDate!==void 0&&e.date!==r.publishDate?(e.date=r.publishDate,t=true):r.publishDate===void 0&&r.date!==void 0&&e.date!==r.date&&(e.date=r.date,t=true);let o=i=>{i in e&&(delete e[i],t=true);};return o("publishDate"),o("date_end"),o("all_day"),o("event"),{migrated:e,changed:t}}async function gu(r){let e=0;for await(let t of Le(r))e+=1;return e}function di(r,e){let t=r.command("migrate").description("Migrate HugoBlox project to newer versions");Qo(t,e),li(t,e);}function fi(r,e){let t=r.command("telemetry").description("Manage HugoBlox telemetry preferences");t.command("enable").description("Enable anonymous telemetry").action(async()=>{e.config.setTelemetryEnabled(true),await e.config.save(),e.logger.success("Telemetry enabled. Thanks for helping improve HugoBlox!");}),t.command("disable").description("Disable telemetry collection").action(async()=>{e.config.setTelemetryEnabled(false),await e.config.save(),e.logger.success("Telemetry disabled. You can re-enable it anytime.");}),t.command("status").description("Show whether telemetry is enabled").action(()=>{let n=e.config.isTelemetryEnabled();e.logger.info(`Telemetry is ${n?"enabled":"disabled"}.`);}),t.action(()=>{let n=e.config.isTelemetryEnabled();e.logger.info(`Telemetry is ${n?"enabled":"disabled"}.`),e.logger.info("Use 'hbx telemetry enable|disable' to change the setting.");});}async function br(r,e,t){let n=z.coerce(e)?.version;if(!n)return;let o=[{path:"hugoblox.yaml",regex:/(hugo_version:\s*['"]?)([\d.]+)(['"]?)/,name:"hugoblox.yaml"},{path:"netlify.toml",regex:/(HUGO_VERSION\s*=\s*['"])([\d.]+)(['"])/,name:"netlify.toml"},{path:".github/workflows/deploy.yml",regex:/(WC_HUGO_VERSION:\s*['"]?)([\d.]+)(['"]?)/,name:"GitHub Actions"}];for(let i of o){let s=k.join(r,i.path);if(await C(s))try{let a=await H.readFile(s,"utf8"),u=a.match(i.regex);if(u){let c=u[2],l=z.coerce(c),d=z.coerce(n);if(l&&d&&z.lt(l,d)){let p=a.replace(i.regex,`$1${n}$3`);await H.writeFile(s,p,"utf8"),t.success(`Updated ${i.name} Hugo version to ${n}`);}}}catch{}}}var yi=["github.com/HugoBlox/kit/modules/blox","github.com/HugoBlox/hugo-blox-builder/modules/blox"];function wi(r,e){r.command("upgrade").alias("update").description("Upgrade HugoBlox modules to the latest version").option("-y, --yes","Skip confirmation").option("--ci","Run in non-interactive mode").option("--force","Force upgrade even if Hugo version is incompatible").option("--beta, --canary","Upgrade to the latest development commit (main branch) instead of stable release").option("--apply-migrations","Automatically run breaking-change migrations after upgrading").option("--skip-migrations","Skip migrations even in non-interactive mode").addOption(new Option("--libs <mode>","How to handle third-party modules").choices(["ignore","update","interactive"]).default("ignore")).action(async(t,n)=>{let{logger:o}=e;await Nr()||(o.error("\u274C You appear to be offline. Please check your internet connection."),process.exit(1));let i=await j();if(!i)throw new y("No Hugo project found in the current directory.");let s=t.canary||t.beta;await No(i.root,{fetchLatest:true,fetchLatestFn:s?Uo:void 0});let a=Bt("Cleaning up obsolete modules...").start(),u=await Vo(i.root,o);a.text="Checking for updates...";let l=(await Ie(i.root,{includeThirdParty:true})).filter(w=>!u.includes(w.path)),d=l.filter(w=>De.some(x=>w.path.startsWith(x))),p=l.filter(w=>!De.some(x=>w.path.startsWith(x))),m=xu(d);if(d.length===0){a.stop(),o.info("\u2139\uFE0F  No official HugoBlox modules found in go.mod");return}let f=[...d],g=[];if(p.length>0){let w=t.libs||"ignore";w==="ignore"?g.push(...p.map(x=>x.path)):w==="update"?f.push(...p):w==="interactive"&&f.push(...p);}let D=f.filter(w=>w.error);if(D.length>0){a.stop(),o.error("\u274C Failed to check for updates for some modules:");for(let w of D)o.error(`   ${w.path}: ${w.error}`);process.exit(1);}let h=[];for(let w of f)s&&w.canaryUpdateAvailable&&w.canaryVersion?h.push({path:w.path,version:w.canaryVersion}):w.updateAvailable&&w.latest&&h.push({path:w.path,version:w.latest});let b=Eu(d,h,!!s);if(h.length===0){if(a.stop(),o.success("\u2705 All checked modules are up to date!"),g.length>0){o.warn(`\u26A0\uFE0F  Skipped ${g.length} third-party module(s) (pinned):`);for(let w of g)o.warn(`   - ${w}`);}return}a.text="Checking version requirements...";let F=await Promise.all(h.map(async w=>{try{let x=await Lo(w.path,w.version);return {...w,min:x}}catch{return {...w,min:void 0}}}));if(a.stop(),!t.force){let w=await Te();if(w){let x=F.filter(N=>{if(!N.min)return  false;let ue=z.coerce(N.min),R=z.coerce(w);return ue&&R&&z.lt(R,ue)});if(x.length>0){o.error("\u274C Hugo version incompatible with upgrade targets:");for(let N of x)o.error(`   ${N.path.split("/").pop()} requires Hugo >= ${N.min} (you have ${w})`);o.info("\u{1F449} Please upgrade Hugo first: https://docs.hugoblox.com/start/cli"),o.info("   Or run with --force to ignore this check."),process.exit(1);}}else o.warn("\u26A0\uFE0F  Could not detect local Hugo version. Skipping compatibility check.");}if(s){o.warn("\u26A0\uFE0F  Upgrading modules to latest beta/canary (development) version.");for(let w of h){let x=f.find(N=>N.path===w.path)?.current??"?";o.info(`   ${w.path.split("/").pop()}: ${G(x)} -> @main`);}}else {o.info(`\u{1F4E6} Updates available for ${h.length} module(s):`);for(let w of h){let x=f.find(N=>N.path===w.path)?.current??"?";o.info(`   ${w.path.split("/").pop()}`),o.info(`     Current: ${G(x)}`),o.info(`     Latest:  ${G(w.version)}`);}}if(g.length>0){o.warn(`\u26A0\uFE0F  Skipping ${g.length} third-party module(s) (use --libs=update to include):`);for(let w of g)o.warn(`   - ${w}`);}if(!t.yes&&!t.ci&&!await O(s?"Are you sure you want to upgrade to the bleeding edge?":"Do you want to upgrade now?",{initial:true})){o.info("Upgrade cancelled");return}let T=!!n.optsWithGlobals().json,B=s?{...process.env,GOPROXY:"direct"}:process.env,Q=F.reduce((w,x)=>{if(!x.min)return w;let N=z.coerce(x.min),ue=z.coerce(w);return N&&(!ue||z.gt(N,ue))?x.min:w},void 0);await yu({projectRoot:i.root,targets:h,modules:f,env:B,maxHugoVersion:Q,logger:o,jsonMode:T}),(t.skipMigrations?false:t.applyMigrations??t.ci??t.yes??false)&&await Cu({context:e,projectRoot:i.root,currentVersion:m,targetVersion:b,isCanary:!!s,jsonMode:T}),o.info(""),o.warn("\u26A0\uFE0F  Important: Please review the release notes for any breaking changes."),o.info("\u{1F449} https://github.com/HugoBlox/hugo-blox-builder/releases");});}async function yu(r){let{projectRoot:e,targets:t,modules:n,env:o,maxHugoVersion:i,logger:s,jsonMode:a}=r,u=k.join(e,"go.mod.backup"),c=k.join(e,"go.sum.backup");if(await wu(e,u,c),a){let d=Bt("Downloading updates...").start();try{let p=t.map(m=>`${m.path}@${m.version}`);await execa("hugo",["mod","get",...p],{cwd:e,env:o}),d.text="Optimizing project configuration...",await execa("hugo",["mod","tidy"],{cwd:e,env:o}),i&&(d.text="Updating Hugo version requirement...",await br(e,i,s)),await gi(u,c),d.succeed(`\u2705 Upgraded ${t.length} module(s)`);}catch(p){d.fail("Failed to upgrade modules"),s.error(String(p)),s.warn("\u26A0\uFE0F  Restoring original configuration..."),await pi(e,u,c)?s.info("\u2705 Restored original go.mod and go.sum"):s.error("\u274C Failed to restore backup. Please check go.mod.backup manually."),process.exit(1);}return}let l=new Listr([{title:"Downloading updates",task:(d,p)=>p.newListr(t.map(m=>{let f=m.path.split("/").pop()||m.path,g=n.find(b=>b.path===m.path)?.current,D=g?G(g):"unknown",h=G(m.version);return {title:`${f}: ${D} \u2192 ${h}`,task:async()=>{await execa("hugo",["mod","get",`${m.path}@${m.version}`],{cwd:e,env:o});}}}),{concurrent:false,rendererOptions:{collapseSubtasks:false}})},{title:"Optimizing project configuration",task:async()=>{await execa("hugo",["mod","tidy"],{cwd:e,env:o});}},...i?[{title:`Updating Hugo version requirement to ${i}`,task:async()=>{await br(e,i,s);}}]:[],{title:"Cleaning up backups",task:async()=>{await gi(u,c);}}],{rendererOptions:{collapseSubtasks:false}});try{await l.run(),s.success(`\u2705 Successfully upgraded ${t.length} module(s)`);}catch(d){s.error(`Failed to upgrade modules: ${d instanceof Error?d.message:String(d)}`),s.warn("\u26A0\uFE0F  Restoring original configuration..."),await pi(e,u,c)?(s.info("\u2705 Restored original go.mod and go.sum"),s.info("\u{1F449} Don't worry, your project is back to how it was.")):s.error("\u274C Failed to restore backup. Please check go.mod.backup manually."),process.exit(1);}}async function wu(r,e,t){try{let n=k.join(r,"go.mod");await H.copyFile(n,e);let o=k.join(r,"go.sum");await C(o)&&await H.copyFile(o,t);}catch(n){throw new Error(`Failed to create backup: ${String(n)}`)}}async function pi(r,e,t){try{let n=k.join(r,"go.mod");await H.copyFile(e,n);let o=k.join(r,"go.sum");return await C(t)&&await H.copyFile(t,o),!0}catch{return  false}}async function gi(r,e){try{await H.rm(r,{force:!0}),await H.rm(e,{force:!0});}catch{}}var bu=[{name:"v0.11.0-authors",triggerVersion:"0.11.0",run:(r,e)=>hr(r,{projectRoot:e,yes:true,strict:true,skipIfDataExists:true})},{name:"v0.11.0-events",triggerVersion:"0.11.0",run:(r,e)=>wr(r,{projectRoot:e,yes:true,strict:true})}];async function Cu(r){let{context:e,projectRoot:t,currentVersion:n,jsonMode:o}=r,i=r.isCanary?"999.0.0":r.targetVersion,s=bu.filter(u=>vu(n,i,u.triggerVersion));if(s.length===0)return;if(e.logger.info(""),e.logger.info("\u{1F6E0}\uFE0F  Applying migrations for breaking changes..."),o){for(let u of s)e.logger.info(`   \u2022 ${u.name}`),await u.run(e,t);return}let a=new Listr(s.map(u=>({title:u.name,task:async()=>{await u.run(e,t);}})),{rendererOptions:{collapseSubtasks:false}});try{await a.run();}catch(u){throw e.logger.error(`Migration failed: ${u instanceof Error?u.message:String(u)}`),u}}function vu(r,e,t){let n=z.coerce(t),o=e?z.coerce(e):void 0,i=r?z.coerce(r):void 0;return !n||!o?false:i?z.gte(i,n)?false:z.gte(o,n):z.gte(o,n)}function xu(r){for(let e of yi){let t=r.find(n=>n.path===e);if(t?.current)return t.current}return r[0]?.current}function Eu(r,e,t){if(t)return "999.0.0";for(let n of yi){let o=e.find(s=>s.path===n);if(o?.version)return o.version;let i=r.find(s=>s.path===n);if(i?.latest)return i.latest}return e[0]?.version??r[0]?.latest}var vr=Pr(cr());var Ee;function Fe(){if(Ee)return Ee;let r=process.env.HBX_CLI_VERSION??process.env.npm_package_version;if(r)return Ee=r,Ee;let e=Su(import.meta.url);try{let t=oe.readFileSync(e,"utf8");Ee=JSON.parse(t).version??"0.0.0";}catch{Ee="0.0.0";}return Ee}function Su(r){let e=k.dirname(fileURLToPath(r)),t=k.resolve(e,"../package.json");return oe.existsSync(t)?t:k.resolve(e,"../../package.json")}async function Ci(){try{let r=await fetch("https://nodejs.org/dist/index.json",{signal:AbortSignal.timeout(3e3)});if(!r.ok)return;let e=await r.json();if(e.length>0&&e[0]?.version)return e[0].version.replace(/^v/,"")}catch{return}}function vi(r,e){r.command("version").description("Show version information for CLI and ecosystem").option("--simple","Show only CLI version (legacy mode)").action(async(t,n)=>{let{logger:o}=e,i=!!n.optsWithGlobals().json,s=Fe();if(t.simple||i){let u={status:"success",version:s};i?o.json(u):o.info(`hbx ${s}`);return}let a=await ku(s);Au(a,o);});}async function ku(r,e){let[t,n,o]=await Promise.all([Te(),Gr(),Ci()]),i={cli:{current:r},node:{current:process.version,latest:o}};t&&(i.hugo={current:t,latest:n});try{let s=await j();if(s){i.projectPath=s.root;let a=await Ie(s.root);a.length>0&&(i.modules=a.map(u=>({name:u.path.split("/").pop()||u.path,current:u.current,latestTagged:u.latest,canaryUpdateAvailable:u.canaryUpdateAvailable,updateAvailable:u.updateAvailable})));}}catch{}return i}function Au(r,e){e.info(""),e.info("\u{1F527} Environment");let t=new vr.default({head:["Component","Version","Status"],colWidths:[25,20,30],style:{head:["cyan","bold"],border:["gray"]}}),n=r.cli.latest&&r.cli.latest!==r.cli.current?"\x1B[33m\u26A0 Update available\x1B[0m":"\x1B[32m\u2713 Current\x1B[0m";if(t.push(["HugoBlox CLI",r.cli.current,n]),r.hugo){let i="\x1B[32m\u2713 Current\x1B[0m";r.hugo.latest&&r.hugo.latest!==r.hugo.current&&(i=`\x1B[33m\u26A0 Update available (Latest: ${r.hugo.latest})\x1B[0m`),t.push(["Hugo",r.hugo.current,i]);}else t.push(["Hugo","\x1B[31mNot installed\x1B[0m","\x1B[33m\u26A0 Required\x1B[0m"]);let o="-";if(r.node.latest&&(r.node.current.replace(/^v/,"")!==r.node.latest?o=`\x1B[33m\u26A0 Update available (Latest: ${r.node.latest})\x1B[0m`:o="\x1B[32m\u2713 Current\x1B[0m"),t.push(["Node.js",r.node.current,o]),console.log(t.toString()),r.modules&&r.modules.length>0){e.info(""),e.info(`\u{1F4E6} Project${r.projectPath?` (${r.projectPath})`:""}`);let i=new vr.default({head:["Module","Current","Stable","Beta (Preview)","Status"],colWidths:[25,20,20,15,25],style:{head:["cyan","bold"],border:["gray"]}}),s=false;for(let a of r.modules){let u="\x1B[32m\u2713 Up to date\x1B[0m";a.updateAvailable?(u="\x1B[33m\u26A0 Update available\x1B[0m",s=true):a.canaryUpdateAvailable&&(u="\x1B[36m\u2139 Preview avail.\x1B[0m");let c=a.canaryUpdateAvailable?"\x1B[36mYes\x1B[0m":"-";i.push([a.name,G(a.current),a.latestTagged?G(a.latestTagged):"-",c,u]);}console.log(i.toString()),s&&(e.info(""),e.info("\u{1F4A1} Tip: Run 'hbx upgrade --yes' to update modules"));}e.info("");}var pe=class r{#e;constructor(e){this.#e=e;}static async load(){try{let e=await H.readFile(ft,"utf8"),t=JSON.parse(e);return new r(t)}catch(e){if(e.code==="ENOENT")return new r({});throw new st("Failed to read configuration",{error:e})}}toJSON(){return this.#e}getLicense(){return process.env[ke]??this.#e.token}setLicense(e){this.#e={...this.#e,token:e};}clearLicense(){let e={...this.#e};e.token=void 0,e.device=void 0,this.#e=e;}isTelemetryEnabled(){return process.env[Tr]==="1"?false:typeof this.#e.telemetry?.enabled=="boolean"?this.#e.telemetry.enabled:true}setTelemetryEnabled(e){this.#e={...this.#e,telemetry:{...this.#e.telemetry,enabled:e,lastPrompted:Date.now()}};}getTelemetryId(){return this.#e.telemetry?.id}async ensureTelemetryId(){let e=this.getTelemetryId();if(e)return e;let t=Xe.randomUUID();return this.#e={...this.#e,telemetry:{...this.#e.telemetry,id:t}},await this.save(),t}getDefaultTemplate(){return this.#e.defaults?.template}getUpdateMetadata(){return this.#e.updates}setUpdateMetadata(e){this.#e={...this.#e,updates:{...this.#e.updates,...e}};}getDeviceInfo(){return this.#e.device}setDeviceInfo(e){this.#e={...this.#e,device:e};}async save(){await H.mkdir(jt,{recursive:true});let e=JSON.stringify(this.#e,null,2);await H.writeFile(ft,e,{mode:384}),await H.chmod(ft,384);}};var Ve=class{#e;#t;constructor(e={}){this.#e=e.json??false,this.#t=e.debug??process.env[ge]==="1";}isJsonMode(){return this.#e}setJsonMode(e){this.#e=e;}setDebug(e){this.#t=e;}info(e){this.#e||process.stdout.write(`${it.blue("i")} ${e}
`);}success(e){this.#e||process.stdout.write(`${it.green("\u2714")} ${e}
`);}warn(e){this.#e||process.stdout.write(`${it.yellow("!")} ${e}
`);}error(e){this.#e||process.stderr.write(`${it.red("\u2716")} ${e}
`);}debug(e){!this.#t||this.#e||process.stdout.write(`${it.gray("debug")} ${e}
`);}json(e){let t=JSON.stringify(e,null,2);process.stdout.write(`${t}
`);}};async function Ei(r,e,t){if(process.env[Mr]==="1")return;let n=e.getUpdateMetadata()??{},o=Date.now(),i=n.latestVersion,s=n.lastChecked??0;if(!i||o-s>jr){let c=await Tu(r,t);c.latestVersion&&(i=c.latestVersion),c.checkedAt>0&&(s=c.checkedAt,e.setUpdateMetadata({lastChecked:s,latestVersion:i}),await e.save());}if(!i||!z.valid(i)||!z.gt(i,r)||!Bu(n,o,i))return;let u=`npm install -g ${mt}`;t.warn(`A new version of hbx is available: ${i} (current ${r}).
Update with: ${u} (or pnpm add -g ${mt}).`),e.setUpdateMetadata({lastNotifiedAt:o,latestVersion:i}),await e.save();}function Bu(r,e,t){return !r||r.lastNotifiedAt===void 0||r.latestVersion!==t?true:e-r.lastNotifiedAt>Or}async function Tu(r,e){try{let t=await fetch(`https://registry.npmjs.org/${encodeURIComponent(mt)}/latest`,{headers:{"User-Agent":`hbx-cli/${r}`}});if(!t.ok)throw new Error(`npm registry responded with status ${t.status}`);return {latestVersion:(await t.json()).version,checkedAt:Date.now()}}catch(t){return e.debug(`update check failed: ${String(t)}`),{checkedAt:Date.now()}}}var Mt=class{constructor(e){this.context=e;this.cancelled=false;}async*create(e){this.cancelled=false;try{if(yield*this.validateConfiguration(e),this.cancelled||(yield*this.fetchTemplate(e.templateId),this.cancelled)||(yield*this.scaffoldSite(e),this.cancelled)||e.options?.autoInstall!==!1&&(yield*this.installDependencies(e),this.cancelled)||e.options?.initGit!==!1&&(yield*this.initializeGit(e),this.cancelled))return;yield*this.completeCreation(e);}catch(t){yield {id:"error",type:"error",title:"Creation Failed",message:t instanceof Error?t.message:String(t),timestamp:new Date,data:{error:t,config:e}};}}async*validateConfiguration(e){yield this.createProgressStep("validate",0,"Starting validation..."),yield this.createProgressStep("validate",25,"Checking template availability...");let t=await this.validate(e);if(yield this.createProgressStep("validate",75,"Validating target path..."),!t.valid)throw new Error(`Validation failed: ${t.errors[0]?.message}`);for(let n of t.warnings)yield {id:"validate",type:"warning",title:"Configuration Warning",message:n.message,timestamp:new Date,data:{field:n.field,suggestion:n.suggestion}};yield this.createSuccessStep("validate","Configuration validated");}async*fetchTemplate(e){yield this.createProgressStep("fetch_template",0,"Fetching available templates...");let t=await fe(this.context);yield this.createProgressStep("fetch_template",50,"Locating template...");let n=t.find(o=>o.id===e);if(!n)throw new Error(`Template "${e}" not found`);yield this.createProgressStep("fetch_template",75,`Found template: ${n.name}`),await this.delay(500),yield this.createSuccessStep("fetch_template",`Template "${n.name}" ready`,{template:n});}async*scaffoldSite(e){let n=(await fe(this.context)).find(s=>s.id===e.templateId);if(!n)throw new Error(`Template "${e.templateId}" not found`);yield this.createProgressStep("scaffold_site",0,"Preparing target directory...");let o=vt(e.targetPath,n.slug);await ct(o),yield this.createProgressStep("scaffold_site",25,"Copying template files...");let i={sampleContent:e.options?.includeSampleContent??true,includeEnv:true,packageManager:e.packageManager||"pnpm"};await bt(this.context,o,n,i),yield this.createProgressStep("scaffold_site",75,"Customizing site configuration..."),await this.customizeSiteConfig(o,e),yield this.createSuccessStep("scaffold_site","Site structure created",{targetDir:o,templateId:e.templateId});}async*installDependencies(e){let t=e.packageManager||"pnpm",n=e.targetPath;yield this.createProgressStep("install_deps",0,`Starting ${t} install...`);try{await Ct(n,t,this.context.logger)?yield this.createSuccessStep("install_deps","Dependencies installed successfully"):yield {id:"install_deps",type:"warning",title:"Dependencies installation skipped",message:"Some dependencies failed to install, but site creation can continue",timestamp:new Date};}catch(o){throw new Error(`Failed to install dependencies: ${String(o)}`)}}async*initializeGit(e){yield this.createProgressStep("init_git",0,"Initializing git repository..."),await Ye(e.targetPath,this.context.logger),yield this.createProgressStep("init_git",75,"Creating initial commit..."),await this.delay(1e3),yield this.createSuccessStep("init_git","Git repository initialized");}async*completeCreation(e){yield this.createProgressStep("complete",50,"Finalizing setup..."),await this.generateSummaryReport(e),yield {id:"complete",type:"success",title:`Site "${e.siteName}" created successfully! \u{1F389}`,progress:100,timestamp:new Date,data:{siteName:e.siteName,targetPath:e.targetPath,templateId:e.templateId,packageManager:e.packageManager,nextSteps:this.generateNextSteps(e)}};}async validate(e){let t=[],n=[];(await fe(this.context)).find(s=>s.id===e.templateId)||t.push({field:"templateId",message:`Template "${e.templateId}" not found`,code:"TEMPLATE_NOT_FOUND"}),(!e.siteName||e.siteName.trim().length===0)&&t.push({field:"siteName",message:"Site name is required",code:"SITE_NAME_REQUIRED"});let i=await xt(e.targetPath);return i.valid||t.push({field:"targetPath",message:i.error||"Invalid target path",code:"INVALID_PATH"}),i.exists&&!i.isEmpty&&n.push({field:"targetPath",message:"Directory is not empty",suggestion:"Files may be overwritten during site creation"}),{valid:t.length===0,errors:t,warnings:n}}async cancel(){this.cancelled=true;}createProgressStep(e,t,n,o){return {id:e,type:"progress",title:this.getStepTitle(e),message:n,progress:t,timestamp:new Date,data:o}}createSuccessStep(e,t,n){return {id:e,type:"success",title:this.getStepTitle(e),message:t,progress:100,timestamp:new Date,data:n}}getStepTitle(e){return {validate:"Validating configuration",fetch_template:"Fetching template",scaffold_site:"Creating site structure",install_deps:"Installing dependencies",init_git:"Initializing git repository",start_server:"Starting development server",complete:"Finalizing setup"}[e]||e}async delay(e){return new Promise(t=>setTimeout(t,e))}async customizeSiteConfig(e,t){this.context.logger.debug(`Customizing site config for ${t.siteName}`);}async generateSummaryReport(e){this.context.logger.debug(`Site creation completed: ${JSON.stringify({template:e.templateId,path:e.targetPath,options:e.options})}`);}generateNextSteps(e){let t=[`cd ${e.targetPath}`];return e.options?.autoInstall===false&&t.push(`${e.packageManager||"pnpm"} install`),e.options?.autoPreview!==false&&t.push(`${e.packageManager||"pnpm"} dev`),t}};var _t=class r{constructor(e){this.context=e;}static{this.PREVIEW_DATA={"academic-cv":{thumbnailUrl:"https://hugoblox.com/previews/academic-cv-thumb.jpg",category:"academic",difficulty:"beginner",estimatedTime:3,features:["Publication lists","Research sections","Academic timeline","Contact forms"],useCases:["Professors","Researchers","PhD students","Academic professionals"]},startup:{thumbnailUrl:"https://hugoblox.com/previews/startup-thumb.jpg",category:"business",difficulty:"intermediate",estimatedTime:5,features:["Landing pages","Pricing tables","Team sections","Newsletter signup"],useCases:["SaaS companies","Startups","Product launches","Marketing sites"]},folio:{thumbnailUrl:"https://hugoblox.com/previews/folio-thumb.jpg",category:"portfolio",difficulty:"beginner",estimatedTime:2,features:["Project galleries","About sections","Contact forms","Responsive design"],useCases:["Designers","Developers","Freelancers","Creative professionals"]}};}async enrichWithPreviews(e,t){let n=e.map(o=>this.enrichTemplate(o));return t?this.applyQueryOptions(n,t):n}enrichTemplate(e){let t=r.PREVIEW_DATA[e.id];return t?{...e,preview:t,stats:this.calculateStats(e)}:{...e,preview:{thumbnailUrl:this.generateFallbackThumbnail(e),category:this.inferCategory(e),difficulty:"intermediate",estimatedTime:4,features:this.inferFeatures(e),useCases:["General purpose"]},stats:this.calculateStats(e)}}generateFallbackThumbnail(e){return `https://hugoblox.com/api/placeholder-thumb/${encodeURIComponent(e.id)}`}inferCategory(e){let t=e.name.toLowerCase(),n=(e.description||"").toLowerCase();return t.includes("academic")||t.includes("cv")||t.includes("research")?"academic":t.includes("startup")||t.includes("business")||n.includes("saas")?"business":t.includes("portfolio")||t.includes("folio")?"portfolio":t.includes("blog")||n.includes("blog")?"blog":t.includes("docs")||t.includes("documentation")?"documentation":"other"}inferFeatures(e){let t=[],n=(e.description||"").toLowerCase();return n.includes("responsive")&&t.push("Mobile responsive"),n.includes("dark")&&t.push("Dark mode support"),n.includes("seo")&&t.push("SEO optimized"),n.includes("multilingual")&&t.push("Multi-language support"),t.length>0?t:["Modern design","Responsive layout"]}calculateStats(e){let t=e.source==="pro"?80:60;return {popularity:["academic-cv","startup","folio"].includes(e.id)?t+20:t,lastUpdated:new Date().toISOString().split("T")[0]}}applyQueryOptions(e,t){let n=[...e];switch(t.category&&(n=n.filter(o=>o.preview.category===t.category)),t.difficulty&&(n=n.filter(o=>o.preview.difficulty===t.difficulty)),t.source&&(n=n.filter(o=>o.source===t.source)),t.sortBy){case "popularity":n.sort((o,i)=>(i.stats?.popularity||0)-(o.stats?.popularity||0));break;case "name":n.sort((o,i)=>o.name.localeCompare(i.name));break;case "difficulty":{let o={beginner:1,intermediate:2,advanced:3};n.sort((i,s)=>o[i.preview.difficulty]-o[s.preview.difficulty]);break}default:n.sort((o,i)=>o.source==="pro"&&i.source!=="pro"?-1:i.source==="pro"&&o.source!=="pro"?1:o.name.localeCompare(i.name));}return t.limit&&t.limit>0&&(n=n.slice(0,t.limit)),n}async getPreview(e){let t=r.PREVIEW_DATA[e];return t?{templateId:e,thumbnailUrl:t.thumbnailUrl,screenshots:await this.getScreenshots(e),demoUrl:await this.getDemoUrl(e),features:t.features,useCases:t.useCases}:null}async getScreenshots(e){let t="https://hugoblox.com/previews/";return [`${t}${e}-1.jpg`,`${t}${e}-2.jpg`,`${t}${e}-3.jpg`]}async getDemoUrl(e){return {"academic-cv":"https://hugoblox.com/templates/academic-cv/",startup:"https://hugoblox.com/templates/startup/",folio:"https://hugoblox.com/templates/portfolio/"}[e]}};var Ht=class{constructor(e){this.context=e;this.templates={fetchAll:async e=>{let t=await fe(this.context);return this.previewService.enrichWithPreviews(t,e)},getById:async e=>(await this.templates.fetchAll()).find(n=>n.id===e)||null,getPreview:async e=>this.previewService.getPreview(e)};this.creation={create:e=>this.creationService.create(e),validate:async e=>this.creationService.validate(e),cancel:async()=>this.creationService.cancel()};this.system={detectPackageManager:async e=>Cn(e||process.cwd()),validatePath:async e=>xt(e),getDefaultConfig:()=>({templateId:"startup",siteName:"my-hugoblox-site",targetPath:"./my-hugoblox-site",packageManager:"pnpm",options:{includeSampleContent:true,initGit:true,autoInstall:true,autoPreview:true},showAdvanced:false,rememberedChoices:{}})};this.previewService=new _t(e),this.creationService=new Mt(e);}};async function Ru(r={}){let e=await $u(r);return new Ht(e)}async function $u(r){let e=Fe(),t=await pe.load(),n=new Ve({debug:r.debug??process.env[ge]==="1",json:true});await t.ensureTelemetryId();let o=r.telemetryEnabled!==false?new we(t,n,e):new xr(t,n,e);return r.progressCallback&&(o.progressCallback=r.progressCallback),{config:t,logger:n,telemetry:o}}var xr=class extends we{async track(){}setCommand(){}};async function Mu(){return (await pe.load()).ensureTelemetryId()}async function Cp(r=process.argv){let e=Fe(),t=await pe.load(),n=new Ve({debug:process.env[ge]==="1"});await t.ensureTelemetryId();let o=new we(t,n,e,process.env.HBX_CLIENT_NAME??"cli"),i={config:t,logger:n,telemetry:o};await Ei(e,t,n),r.includes("--json")||console.log(`
\u{1F44B} ${it.bold("Welcome to the Early Access / Preview Edition of HugoBlox CLI!")}
   We'd love your feedback on our Discord: ${it.underline("https://hugoblox.com/discord")}
   Report issues: ${it.underline("https://github.com/HugoBlox/kit/issues")}
`),await ju(i);let s=new Command;s.name("hbx").description("HugoBlox Experience CLI").version(e,"-v, --version","Show CLI version").option("--json","Output machine-readable JSON").option("--debug","Enable verbose logging"),s.hook("preAction",(a,u)=>{let c=u?.optsWithGlobals?.()??a.optsWithGlobals();n.setJsonMode(!!c.json),n.setDebug(!!c.debug||process.env[ge]==="1"),o.setCommand(Iu(u));}),kn(s,i),sn(s,i),qo(s,i),Tn(s,i),zo(s,i),Xo(s,i),Yo(s,i),di(s,i),wi(s,i),fi(s,i),vi(s,i);try{await s.parseAsync(r);}catch(a){Hu(a,n);}}function Hu(r,e){if(at(r)){let t={status:"error",code:r.code,message:r.message,details:r.details};e.isJsonMode()?e.json(t):e.error(`${r.code}: ${r.message}`);}else r instanceof ee?e.error(`${r.code}: ${r.message}`):r instanceof Error?e.error(r.message):e.error("Unknown error");process.exit(1);}function Iu(r){if(!r)return dt;let e=[],t=r;for(;t?.parent;){let n=t.name?.();n&&e.unshift(n),t=t.parent;}return e.length?`${dt} ${e.join(" ")}`.trim():dt}async function ju(r){if(process.env[ke]&&r.config.getLicense()&&!r.config.getDeviceInfo())try{await Y(r);}catch(e){r.logger.debug(`Skipping device registration warm-up: ${String(e)}`);}}

export { Fe as a, Ru as b, Mu as c, Cp as d };
